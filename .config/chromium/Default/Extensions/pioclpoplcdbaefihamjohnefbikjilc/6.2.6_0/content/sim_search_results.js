var baseUrl,locale,userId,shardId,totalNumNotes=0;
window.addEventListener("DOMContentLoaded",function(){GlobalUtils.localize(document.body);document.querySelector("#closeButton").addEventListener("click",toggleCloseOptions);document.querySelector("#dismiss").addEventListener("click",dismiss);document.querySelector("#dismissForever").addEventListener("click",dismissForever);for(var a=decodeURI(document.location.href),c=/(locale|baseUrl|userId|shardId)=([^&]+)/g,b=c.exec(a);b;)"locale"===b[1]?locale=b[2]:"baseUrl"===b[1]?baseUrl=b[2]:"userId"===b[1]?
userId=b[2]:"shardId"===b[1]&&(shardId=b[2]),b=c.exec(a);/china/i.test(locale)&&(document.querySelector(".branding span").className="china");userId?(Browser.addMessageHandlers({simsearch_receiveRelatedNotes:msgHandlerReceiveRelatedNotes,tellUserToLogin:tellUserToLogin}),Browser.sendToExtension({name:"simSearch_getNotesRelatedToSearchQuery"})):tellUserToLogin()});
function msgHandlerReceiveRelatedNotes(a,c,b){document.querySelector(".branding").href=baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(a.tokens.pers)+"&targetUrl="+encodeURIComponent("/Home.action");if(a.relatedNotes){c=a.relatedNotes;var d;"account"===a.type?(d=document.querySelector("#account .noteSectionNotes"),b=a.isBizUser?"searchHelperTopMatchesBiz":"searchHelperTopMatchesPers",1==c.length&&(b+="One"),b=Browser.i18n.getMessage(b,[c.length]),document.querySelector("#account .noteSectionTitle").innerText=
b):"library"===a.type?(d=document.querySelector("#library .noteSectionNotes"),1==c.length?document.querySelector("#library .noteSectionTitle").innerText=Browser.i18n.getMessage("searchHelperTopBizLibraryMatchesOne"):document.querySelector("#library .noteSectionTitle").innerText=Browser.i18n.getMessage("searchHelperTopBizLibraryMatches",[c.length])):"all"===a.type&&(d=document.querySelector("#all .noteSectionNotes"),1==c.length?document.querySelector("#all .noteSectionTitle").innerText=Browser.i18n.getMessage("searchHelperTopMatchesPersOne"):
document.querySelector("#all .noteSectionTitle").innerText=Browser.i18n.getMessage("searchHelperTopMatchesPers",[c.length]));d.parentNode.style.display=0<c.length?"block":"none";a=new NoteSnippets(d,baseUrl,userId,shardId,a.tokens,null,!0,function(a,b){b?Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"expert",value:totalNumNotes}):a?Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"business",value:totalNumNotes}):
Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"personal",value:totalNumNotes})});a.renderBlocks(c);totalNumNotes+=c.length;var f=document.createElement("div");f.className="noteSectionShadow";d.parentNode.insertBefore(f,d);d.addEventListener("overflowchanged",function(a){f.style.display=a.horizontalOverflow?"block":"none"});"block"==document.querySelector("#noNotes").style.display&&(document.querySelector("#noNotes").style.display="none",Browser.sendToExtension({name:"setPersistentValue",
key:userId+"_noSimsearchResultsShown",value:!1}));Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight(a.hasAtLeastOneNotebookName())}})}else document.querySelector("#"+a.type+" .noteSectionNotes").parentNode.style.display="none",document.querySelector("#"+a.type+" .noteSectionNotes").innerHTML="",0<getWindowHeight()||(a.noSimsearchResultsShown&&!1!=a.noSimsearchResultsShown?Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}}):
(document.querySelector("#noNotes").style.display="block",Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight()}}),Browser.sendToExtension({name:"setPersistentValue",key:userId+"_noSimsearchResultsShown",value:!0})))}
function getWindowHeight(a){var c=document.querySelector("#account .noteSectionNotes"),b=document.querySelector("#library .noteSectionNotes"),d=document.querySelector("#all .noteSectionNotes"),f=document.querySelector("#noNotes"),e=0;""!=c.innerHTML&&(e=263);if(""!=b.innerHTML||""!=d.innerHTML)e=a?282:263;""!=c.innerHTML&&""!=b.innerHTML&&(e=500);"block"==f.style.display&&(e=85);return e}
function toggleCloseOptions(){"block"==document.querySelector("#closeOptions").style.display?document.querySelector("#closeOptions").style.display="none":document.querySelector("#closeOptions").style.display="block"}function dismiss(){Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}});Browser.sendToExtension({name:"bounce",message:{name:"temporarilyDisableSimSearch"}})}
function dismissForever(){dismiss();Browser.sendToExtension({name:"main_setOption",options:{useSearchHelper:!1}})}function tellUserToLogin(){document.querySelector("#simSearchNotes").innerHTML=Browser.i18n.getMessage("searchHelperLoginMessage",[baseUrl+"/Login.action"]);Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:85}})};
