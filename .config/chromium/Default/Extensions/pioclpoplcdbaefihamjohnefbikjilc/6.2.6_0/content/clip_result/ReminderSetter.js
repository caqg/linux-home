function ReminderSetter(n,z,A,B,C,D,E,I,w){function u(){var b=a.querySelector("#date span.focused");b&&b.classList.remove("focused");this.classList.add("focused")}function F(b,a){var d=new Date(b.year,b.month,b.date,hour,minute,0,0);G.innerHTML=c.format(d);l=document.getElementById("selectedMonth");h=document.getElementById("selectedDate");k=document.getElementById("selectedYear");q=document.getElementById("selectedHour");r=document.getElementById("selectedMinute");s=document.getElementById("selectedMeridian");
l.addEventListener("click",u);h.addEventListener("click",u);k.addEventListener("click",u);q.addEventListener("click",u);r.addEventListener("click",u);s.addEventListener("click",u);if(a)switch(a){case "year":k.click();break;case "month":l.click();break;case "date":h.click();break;case "hour":q.click();break;case "minute":r.click();break;case "meridian":s.click()}return d}function H(){E();n.classList.contains("added")?(c.selectedDate()||a.classList.remove("hasDate"),c.showTodayOrSelected()):(n.classList.add("added"),
x=Date.now(),Browser.sendToExtension({name:"setReminder",shardId:A,token:z,noteGuid:B,title:C,sourceURL:D,reminderOrder:x}),w(ReminderSetter.REMINDER_TYPES.NO_DATE));if(a.classList.toggle("visible"))n.classList.add("changingDate");else{n.classList.remove("changingDate");var b=a.querySelector("#date span.focused");b&&b.classList.remove("focused")}}var a=document.createElement("div");a.id="remindersSetter";a.innerHTML='<div id="noDate"><div class="reminderHeader">'+Browser.i18n.getMessage("reminderAdded")+
'</div><div id="addDate" class="reminderButton">'+Browser.i18n.getMessage("addDate")+'</div></div><div id="hasDate"><div class="reminderHeader">'+Browser.i18n.getMessage("notifyMe")+'</div><div id="tomorrow" class="reminderButton">'+Browser.i18n.getMessage("tomorrow")+'</div><div id="nextWeek" class="reminderButton">'+Browser.i18n.getMessage("nextWeek")+'</div><div id="date"></div><div id="datePicker"></div></div>';n.parentNode.insertBefore(a,n.nextElementSibling);var m=Math.min(255,456-n.offsetLeft-
38);m+130<456-n.offsetLeft+5?(a.style.left=Math.max(5,n.offsetLeft-38)+"px",a.style.webkitTransformOrigin=n.offsetLeft+9+"px 0"):(a.style.right=m+"px",a.style.webkitTransformOrigin="-webkit-calc(100% - "+(456-m-n.offsetLeft+9)+"px) 0");var x=null,l,h,k,q,r,s,G=document.getElementById("date"),p,v=!1,c=new DatePicker(document.getElementById("datePicker"),function(b,c){Browser.sendToExtension({name:"setReminder",token:z,shardId:A,noteGuid:B,title:C,sourceURL:D,reminderOrder:x,reminderTime:F(b,c)-0});
v||(v=!0,w(ReminderSetter.REMINDER_TYPES.CUSTOM_DATE))}),m=new Date;F({year:m.getFullYear(),month:m.getMonth(),date:m.getDate()});var m=document.getElementById("addDate"),t=document.querySelector("#noDate .reminderHeader");if(m.scrollWidth>m.clientWidth||t.scrollWidth>t.clientWidth||a.scrollHeight>a.clientHeight){var y=document.createElement("style");m.scrollWidth>m.clientWidth||t.scrollWidth>t.clientWidth?(t=Math.max(m.scrollWidth-m.clientWidth,t.scrollWidth-t.clientWidth),y.innerText="#remindersSetter { width: "+
(112+t)+"px; }"):a.scrollHeight>a.clientHeight&&(y.innerText="#remindersSetter { height: "+(165+a.scrollHeight-a.clientHeight)+"px; }");document.head.appendChild(y)}n.addEventListener("click",H);m.addEventListener("click",function(){E();a.classList.add("hasDate")});document.getElementById("tomorrow").addEventListener("click",function(){v||(v=!0,w(ReminderSetter.REMINDER_TYPES.TOMORROW));var b=new Date;b.setDate(b.getDate()+1);c.selectDate(b)});document.getElementById("nextWeek").addEventListener("click",
function(){v||(v=!0,w(ReminderSetter.REMINDER_TYPES.NEXT_WEEK));var b=new Date;b.setDate(b.getDate()+7);c.selectDate(b)});a.addEventListener("click",function(b){G.contains(b.srcElement)||(b=a.querySelector("#date span.focused"))&&b.classList.remove("focused")});a.addEventListener("webkitTransitionEnd",function(b){"width"===b.propertyName&&!a.classList.contains("hasDate")&&a.scrollHeight>a.clientHeight?(b=document.createElement("style"),b.innerText="#remindersSetter { height: "+(53+a.scrollHeight-
a.clientHeight)+"px; }",document.head.appendChild(b)):"height"!==b.propertyName&&"opacity"!==b.propertyName||I()});window.addEventListener("keydown",function(b){var a=document.querySelector("#date span.focused");if(a){clearTimeout(p);var d=parseInt(k.innerText||k.textContent),e=parseInt(l.innerText||l.textContent)-1,f=parseInt(h.innerText||h.textContent);if("Up"==b.keyIdentifier)a===k?c.selectDate(new Date(d+1,e,f),"year"):a===l?c.selectDate(new Date(d,e+1,f),"month"):a===h?c.selectDate(new Date(d,
e,f+1),"date"):a===q?(hour=(hour+1)%24,c.selectDate(new Date(d,e,f),"hour")):a===r?(minute=(minute+1)%60,c.selectDate(new Date(d,e,f),"minute")):a===s&&(hour=(hour+12)%24,c.selectDate(new Date(d,e,f),"meridian"));else if("Right"==b.keyIdentifier)a.nextElementSibling&&a.nextElementSibling.click();else if("Down"==b.keyIdentifier)a===k?c.selectDate(new Date(d-1,e,f),"year"):a===l?c.selectDate(new Date(d,e-1,f),"month"):a===h?c.selectDate(new Date(d,e,f-1),"date"):a===q?(hour=(hour-1+24)%24,c.selectDate(new Date(d,
e,f),"hour")):a===r?(minute=(minute-1+60)%60,c.selectDate(new Date(d,e,f),"minute")):a===s&&(hour=(hour-12+24)%24,c.selectDate(new Date(d,e,f),"meridian"));else if("Left"==b.keyIdentifier)a.previousElementSibling&&a.previousElementSibling.click();else if(48<=b.keyCode&&57>=b.keyCode||96<=b.keyCode&&105>=b.keyCode){var g=b.keyCode%48;57<b.keyCode&&(g=b.keyCode%96);a===k?3>k.innerText.length?(k.innerText+=g,p=setTimeout(function(){c.selectDate(new Date(parseInt(k.innerText||k.textContent),e,f))},500)):
3==k.innerText.length?(k.innerText+=g,c.selectDate(new Date(parseInt(k.innerText||k.textContent),e,f))):(k.innerText=g,p=setTimeout(function(){c.selectDate(new Date(parseInt(k.innerText||k.textContent),e,f))},500)):a===l?2>l.innerText.length?-1==e?(l.innerText=g,c.selectDate(new Date(d,g-1,f))):3>g?(l.innerText+=g,c.selectDate(new Date(d,parseInt(l.innerText||l.textContent)-1,f))):p=setTimeout(function(){c.selectDate(new Date(d,e,f))},500):(l.innerText=g,1<g?c.selectDate(new Date(d,g-1,f)):p=setTimeout(function(){var a=
parseInt(l.innerText||l.textContent)-1,a=0>a?e:a;c.selectDate(new Date(d,a,f))},500)):a===h?2>h.innerText.length?2>f?(h.innerText+=g,c.selectDate(new Date(d,e,parseInt(h.innerText||h.textContent)))):(new Date(d,e,10*f+g)).getDate()==10*f+g?(h.innerText+=g,c.selectDate(new Date(d,e,parseInt(h.innerText||h.textContent)))):p=setTimeout(function(){c.selectDate(new Date(d,e,f))},500):(h.innerText=g,3<g?c.selectDate(new Date(d,e,parseInt(h.innerText||h.textContent))):p=setTimeout(function(){c.selectDate(new Date(d,
e,parseInt(h.innerText||h.textContent)))},500)):a===q?2>q.innerText.length?(b=parseInt(q.innerText),0==b?(hour=g,c.selectDate(new Date(d,e,f))):1==b&&(3>g?(hour=10+g,c.selectDate(new Date(d,e,f))):p=setTimeout(function(){hour=1;c.selectDate(new Date(d,e,f))},500))):2>g?(q.innerText=g,p=setTimeout(function(){0!=g&&(hour=g);c.selectDate(new Date(d,e,f))},500)):(hour=g,c.selectDate(new Date(d,e,f))):a===r&&(2>r.innerText.length?(b=parseInt(r.innerText),minute=10*b+g,c.selectDate(new Date(d,e,f))):6>
g?(r.innerText=g,p=setTimeout(function(){0!=g&&(minute=g);c.selectDate(new Date(d,e,f))},500)):(minute=g,c.selectDate(new Date(d,e,f))))}else if((65==b.keyCode||80==b.keyCode)&&a===s){if("AM"==s.innerText&&80==b.keyCode||"PM"==s.innerText&&65==b.keyCode)hour=(hour+12)%24;c.selectDate(new Date(d,e,f))}}});window.addEventListener("click",function(b){!a.classList.contains("visible")||a.contains(b.srcElement)||n.contains(b.srcElement)||H.call(n)});this.__defineGetter__("height",function(){return a.classList.contains("visible")?
a.offsetHeight+5:0});this.__defineGetter__("top",function(){return a.offsetTop});Object.preventExtensions(this)}ReminderSetter.REMINDER_TYPES={NO_DATE:1,TOMORROW:2,NEXT_WEEK:3,CUSTOM_DATE:4};Object.preventExtensions(ReminderSetter);
