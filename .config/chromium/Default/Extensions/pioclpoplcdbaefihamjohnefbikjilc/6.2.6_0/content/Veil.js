function Veil(){function h(c){if(c.srcElement!==document.documentElement&&e&&e.style&&(e.style.top=c.clientY+"px",e.style.left=c.clientX+"px",d)){var b,k,f;b=Math.min(c.clientX,d.x);k=Math.min(c.clientY,d.y);f=Math.max(c.clientX,d.x);c=Math.max(c.clientY,d.y);a.style.borderTopWidth=k+"px";a.style.borderRightWidth=window.innerWidth-f+"px";a.style.borderBottomWidth=window.innerHeight-c+"px";a.style.borderLeftWidth=b+"px"}}function l(c){c.srcElement!==document.documentElement&&1===c.which&&(document.body.style.overflowY=
"hidden",document.body.style.overflowX="hidden",d={x:c.clientX,y:c.clientY},b&&b.parentNode&&b.parentNode.removeChild(b),Browser.sendToExtension({name:"bounce",message:{name:"goToSkitchWaitingMode"}}),a.style.borderTopWidth=d.y+"px",a.style.borderRightWidth=window.innerWidth-d.x+"px",a.style.borderBottomWidth=window.innerHeight-d.y+"px",a.style.borderLeftWidth=d.x+"px")}function m(c){if(c.srcElement!==document.documentElement&&1===c.which){var b={x:Math.min(c.clientX,d.x),y:Math.min(c.clientY,d.y)},
a={x:Math.max(c.clientX,d.x),y:Math.max(c.clientY,d.y)};c.clientX===a.x?(a.x--,b.x++):(b.x++,a.x--);c.clientY===a.y?(a.y--,b.y++):(b.y++,a.y--);16>a.x-b.x+1&&16>a.y-b.y+1?setTimeout(function(){(new Audio(Browser.extension.getURL("skitch/sounds/snap.wav"))).play();Browser.sendToExtension({name:"captureScreenshot"})},500):((new Audio(Browser.extension.getURL("skitch/sounds/snap.wav"))).play(),Browser.sendToExtension({name:"captureScreenshot",start:b,end:a,screenshotHeight:window.innerHeight}));n();
p()}}function g(){e&&e.parentNode&&e.parentNode.removeChild(e);b&&b.parentNode&&b.parentNode.removeChild(b);window.removeEventListener("mousemove",h);window.removeEventListener("mousedown",l);window.removeEventListener("mouseup",m);d=null}function p(){a&&a.parentNode&&a.parentNode.removeChild(a)}function n(){g();a.style.borderTopWidth="0";a.style.borderRightWidth="0";a.style.borderBottomWidth=window.innerHeight+"px";a.style.borderLeftWidth="0"}var e,b,d=null,a=document.createElement("div");a.style.width=
"100%";a.style.height="100%";a.style.boxSizing="border-box";a.style.top="0";a.style.left="0";a.style.position="fixed";a.style.borderStyle="solid";a.style.borderWidth="0";a.style.zIndex="2147483646";Browser.addMessageHandlers({receivePersistentValue:function(a,d,e){function f(a){"opacity"===a.propertyName&&b&&b.parentNode&&(b.removeEventListener("webkitTransitionEnd",f),b.classList.remove("evernoteClipperHidden"),b.parentNode.removeChild(b))}"sawScreenshotToast"===a.key&&(a.value&&a.value[a.currentUserId]?
b&&b.parentNode&&(b.addEventListener("webkitTransitionEnd",f),b.classList.add("evernoteClipperHidden")):(a.value||(a.value={}),a.value[a.currentUserId]=!0,Browser.sendToExtension({name:"setPersistentValue",key:"sawScreenshotToast",value:a.value})))}});this.enableCrosshair=function(){g();e||(e=document.createElement("div"),e.id="evernoteClipperCrosshair");b||(b=document.createElement("iframe"),b.id="evernoteClipperCrosshairToast",b.src=Browser.extension.getURL("content/tooltips/screenshot_toast.html"));
document.documentElement.appendChild(e);document.documentElement.appendChild(b);setTimeout(function(){b&&b.parentNode&&Browser.sendToExtension({name:"getPersistentValue",key:"sawScreenshotToast"})},3E3);window.addEventListener("mousemove",h);window.addEventListener("mousedown",l);window.addEventListener("mouseup",m)};this.disableCrosshair=g;this.removeVeil=p;this.reset=n;this.setColor=function(b){a.style.borderColor=b};this.showVeil=function(){document.documentElement.appendChild(a)};Object.preventExtensions(this)}
Object.preventExtensions(ContentVeil);
