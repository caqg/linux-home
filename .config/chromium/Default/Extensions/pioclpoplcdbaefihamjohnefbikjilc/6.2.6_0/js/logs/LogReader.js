function LogReader(s,t){function u(c){log.error("Failed to init FileSystem.")}function n(c){if(c.length){for(var b=0;b<c.length;b++)c[b].isFile&&g.push(c[b]);l.readEntries(n,p)}else t()}function p(){log.error("Error reading log directory.");t()}function q(c,b){if(g.length)if(h==g.length){var a="Clipper "+Browser.EVERNOTE_VERSION+", "+BUILD_VERSION+"/"+SKITCH_BUILD_VERSION+"\n"+navigator.userAgent+"\n\n";if("arraybuffer"===b){for(var f=new Uint8Array(a.length),e=0;e<a.length;e++)f[e]=a.charCodeAt(e);
d.unshift(f.buffer);k+=f.buffer.byteLength;a=new Uint8Array(k);for(e=f=0;e<d.length;e++)a.set(new Uint8Array(d[e]),f),f+=d[e].byteLength;d=a.buffer}else d=a+d;c(d);h=0;d="";m=!1;k=0}else{0===h&&"arraybuffer"===b&&(d=[]);if("arraybuffer"===b){f="\n\n"+g[h].name+"\n";a=new Uint8Array(f.length);for(e=0;e<f.length;e++)a[e]=f.charCodeAt(e);d.push(a.buffer);k+=a.buffer.byteLength}else d+=g[h].name+"\n";g[h].file(function(a){"arraybuffer"===b?x(a,function(){d.push(this.result);k+=this.result.byteLength;
h++;q(c,b)}):v(a,function(){d+=this.result+"\n\n";h++;q(c)})},w)}}function v(c,b){var a=new FileReader;a.onloadend=b;a.readAsText(c)}function x(c,b){var a=new FileReader;a.onloadend=b;a.readAsArrayBuffer(c)}function w(){log.error("readLogFailed.");m=!1}var r,l,g=[],h,d,k,m;h=0;d="";m=!1;k=0;webkitRequestFileSystem(PERSISTENT,Log.maxLogSize,function(c){r=c;s?r.root.getDirectory(s,{create:!0},function(b){l=b.createReader();l.readEntries(n,p)},u):(l=r.root.createReader(),l.readEntries(n,p))},u);this.getLog=
function(c,b){g[c].file(function(a){v(a,function(a){b(this.result)})},w)};this.getLogsProperties=function(c){for(var b=[],a=0;a<g.length;a++){b.push({});for(var d=0;d<c.length;d++)b[a][c[d]]=g[a][c[d]]}return b};this.startExportLogs=function(c,b){m||(m=!0,q(c,b))};Object.preventExtensions(this)}Object.preventExtensions(LogReader);
