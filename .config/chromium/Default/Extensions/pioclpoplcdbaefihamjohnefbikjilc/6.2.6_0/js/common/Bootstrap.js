function Bootstrapper(n,t,h,p){function l(k){u=new JsonRpc(null,["UserStore.checkVersion","UserStore.getBootstrapInfo"],null,p,z.get("serviceHost"),h);var b=h.trim();""!==b&&(f=[b,b]);u.initWithUrl(p+f[k]+"/json");var b=new Date,a=(9>=b.getUTCMonth()+1?"0"+(b.getUTCMonth()+1):(b.getUTCMonth()+1).toString())+b.getUTCDate().toString()+b.getUTCFullYear().toString(),d=Persistent.get("checkedVersion");d||(d={});d[a]||(d[a]={});for(var e in d)e!==a&&delete d[e];Persistent.set("checkedVersion",d);e=parseInt(Persistent.get("deviceID").substr(0,
3),16)%1440;b=60*b.getUTCHours()+b.getUTCMinutes();(void 0===d[a][f[k]]||null===d[a][f[k]])&&b>=e?(d[a][f[k]]=!0,Persistent.set("checkedVersion",d),b=GlobalUtils.generateSystemInfo(),b="EvernoteClipper/"+Browser.EVERNOTE_VERSION+"; "+b.browser.replace(" ","/")+"; "+b.os.replace(" ","/"),u.client.UserStore.checkVersion(function(b,e){e&&"number"==typeof e.code&&200!=e.code||(d[a][f[k]]=b,Persistent.set("checkedVersion",d));c(b,e)},b,EDAM_VERSION_MAJOR,EDAM_VERSION_MINOR),A++,v&&(m=setTimeout(q,3E3))):
void 0===d[a][f[k]]||null===d[a][f[k]]?c(!0):c(d[a][f[k]])}function q(){m&&clearTimeout(m);u.client.UserStore.getBootstrapInfo(a,w);m=setTimeout(a,3E3)}function c(a,b){b&&("number"==typeof b.code&&200!=b.code?(log.warn("HTTP Error checking version. Assuming OK."),a=!0):log.log("Error checking version: "+JSON.stringify(b)));!0===a?v?q():g(r):(r=!1,alert(Browser.i18n.getMessage("checkVersionWarning")),g(r))}function a(a,b){m&&clearTimeout(m);if(a&&a.profiles&&a.profiles.list){a=a.profiles.list;for(var c=
0,d=z.getName(),e=0;e<a.length;e++)"undefined"!==typeof a[e].name&&a[e].name===d&&(c=e);Persistent.set("BootstrapInfoIndex",c);Persistent.set("BootstrapInfo",a)}else if(2<=A)log.error("Couldn't contact either bootstrap server. Using what we've got...");else{l(B);return}g(r);x=!1}function g(a){for(var b=s.length-1;0<=b;b--){try{s[b](a)}catch(c){log.error("Error running callback: "+c.message+c.stack)}s.pop()}s=[]}var w=navigator.language;n&&(log.log("Will simulate Simplified Chinese."),w="zh-CN");var s=
[],x=!1,r=!0,z=new BootstrapInfo(h),y=0;"zh-CN"===w&&(y=1);var B=y?0:1,A=0,f=["www.evernote.com","app.yinxiang.com"];n=["stage.evernote.com","stage-china.evernote.com"];t&&(f=n);var u,m,v=!0;this.bootstrap=function(a,b){a&&s.push(a);navigator.onLine?x||(v=b,l(y),x=!0):(log.log("Bootstrapping while offline, will use existing info."),g(r))};Object.preventExtensions(this)}Object.preventExtensions(Bootstrapper);
function BootstrapInfo(n){function t(){var c=h(),a=Persistent.get(l);return a&&a.length>c&&"undefined"!==typeof a[c].name?a[c].name:""}function h(){var c=Persistent.get(p);return c?c:0}var p="BootstrapInfoIndex",l="BootstrapInfo",q={serviceHost:"www.evernote.com",marketingUrl:"http://www.evernote.com",supportUrl:"https://support.evernote.com",accountEmailDomain:"www.evernote.com",enableFacebookSharing:!0,enableGiftSubscriptions:!0,enableSharedNotebooks:!0,enableSingleNoteSharing:!0,enableSponsoredAccounts:!0,
enableSupportTickets:!0,enableTwitterSharing:!0};this.getIndex=h;this.setIndex=function(c){Persistent.set(p,c);var a=h();c!==a&&Persistent.clear("savedAuthInfo")};this.getLength=function(){var c=Persistent.get(l);return c&&c.length?c.length:0};this.get=function(c){if("name"==c)return t();if("serviceHost"==c){var a=n;a&&(a=a.trim());if(a)return log.log("Using overidden serviceHost: "+a),a}if("undefined"===typeof q[c])return log.error("Invalid Bootstrap Info Key: "+c),!1;var a=h(),g=Persistent.get(l);
return g&&g.length>a&&g[a].settings?g[a].settings[c]:q[c]};this.getName=t;Object.preventExtensions(this)}Object.preventExtensions(BootstrapInfo);
