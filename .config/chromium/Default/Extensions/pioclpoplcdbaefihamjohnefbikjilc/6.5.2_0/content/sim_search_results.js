/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
"use strict";function msgHandlerReceiveRelatedNotes(a){document.getElementsByClassName("branding")[0].href=baseUrl+"/Home.action";for(var b in a.relatedNotes){var c=a.relatedNotes[b],d=document.createElement("div");d.classList.add("noteSectionNotes");var e=document.createElement("div");e.classList.add("noteSectionTitle");var f,g;"Google"===a.searchEngine?c[0].inBusinessNotebook||"expert"===c[0].type?(f=document.getElementById("library"),g="searchHelperTopBizLibraryMatches"):(f=document.getElementById("account"),g=a.tokens.biz?"searchHelperTopMatchesBiz":"searchHelperTopMatchesPers"):(f=document.getElementById("all"),g="searchHelperTopMatchesPers"),1===c.length&&(g+="One"),e.textContent=Browser.i18n.getMessage(g,[c.length]),f.innerHTML="",f.appendChild(e),f.appendChild(d);var h=new NoteSnippets(d,baseUrl,userId,shardId,a.tokens,null,!0,function(a,b){Browser.sendToExtension(b?{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"expert",value:totalNumNotes}:a?{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"business",value:totalNumNotes}:{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"personal",value:totalNumNotes})});h.renderBlocks(c),totalNumNotes+=c.length}a.relatedNotes.length?Browser.sendToExtension({name:"getPersistentValue",key:"confirmedSimsearch"}):a.noSimsearchResultsShown?Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}}):(document.getElementById("noNotes").style.display="block",Browser.sendToExtension({name:"setPersistentValue",key:userId+"_noSimsearchResultsShown",value:!0}),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight()}}))}function getWindowHeight(){return document.body.offsetHeight}function toggleCloseOptions(){document.querySelector("#closeOptions").style.display="block"==document.querySelector("#closeOptions").style.display?"none":"block"}function dismiss(){Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}}),Browser.sendToExtension({name:"bounce",message:{name:"temporarilyDisableSimSearch"}})}function dismissForever(){dismiss(),Browser.sendToExtension({name:"main_setOption",options:{useSearchHelper:!1}})}function confirmSimsearch(){document.getElementById("featureInfo").classList.remove("visible"),Browser.sendToExtension({name:"setPersistentValueForCurrentUser",key:"confirmedSimsearch",value:!0}),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight()}})}function tellUserToLogin(){document.querySelector("#simSearchNotes").innerHTML=Browser.i18n.getMessage("searchHelperLoginMessage",[baseUrl+"/Login.action"]),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:85}})}function receivePersistentValue(a){"confirmedSimsearch"===a.key&&(a.value&&a.value[a.currentUserId]||(document.getElementById("featureInfo").classList.add("visible"),Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"feature_info",label:"feature_info_shown"})),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight()}}))}var baseUrl,locale,userId,shardId,totalNumNotes=0;window.addEventListener("DOMContentLoaded",function(){GlobalUtils.localize(document.body),document.getElementById("closeButton").addEventListener("click",toggleCloseOptions),document.getElementById("dismiss").addEventListener("click",dismiss),document.getElementById("dismissForever").addEventListener("click",dismissForever),document.getElementById("keepSimsearchOn").addEventListener("click",function(){Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"feature_info",label:"always_show_clicked"}),Browser.sendToExtension({name:"main_recordActivity"}),confirmSimsearch(),Browser.sendToExtension({name:"main_setOption",options:{useSearchHelper:!0}})}),document.getElementById("disableSimsearch").addEventListener("click",function(){Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"feature_info",label:"never_show_clicked"}),Browser.sendToExtension({name:"main_recordActivity"}),confirmSimsearch(),dismissForever()}),document.querySelector("#featureInfo .info").addEventListener("click",function(){Browser.sendToExtension({name:"trackEvent",category:"Simsearch",action:"feature_info",label:"whats_this_clicked"}),Browser.sendToExtension({name:"main_recordActivity"})});for(var a=decodeURI(document.location.href),b=/(locale|baseUrl|userId|shardId)=([^&]+)/g,c=b.exec(a);c;)"locale"===c[1]?locale=c[2]:"baseUrl"===c[1]?baseUrl=c[2]:"userId"===c[1]?userId=c[2]:"shardId"===c[1]&&(shardId=c[2]),c=b.exec(a);/china/i.test(locale)&&(document.querySelector(".branding span").className="china"),userId?(Browser.addMessageHandlers({receivePersistentValue:receivePersistentValue,simsearch_receiveRelatedNotes:msgHandlerReceiveRelatedNotes,tellUserToLogin:tellUserToLogin}),Browser.sendToExtension({name:"simSearch_getNotesRelatedToSearchQuery"})):tellUserToLogin()});