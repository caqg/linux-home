/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function HtmlSerializer(){"use strict";function a(a,b){if(b=b.toLowerCase(),b.match(/^on/i))return!1;if(b.match(/^data-/i))return!1;if(ha.indexOf(b)>-1)return!1;switch(a){case"a":return la.indexOf(b)>-1||ka.indexOf(b)>-1?!0:["charset","coords","href","hreflang","name","rel","rev","shape","target","type"].indexOf(b)>-1?!0:!1;case"abbr":return la.indexOf(b)>-1?!0:!1;case"acronym":return la.indexOf(b)>-1?!0:!1;case"address":return la.indexOf(b)>-1?!0:!1;case"area":return la.indexOf(b)>-1||ka.indexOf(b)>-1?!0:["alt","coords","href","nohref","shape","target"].indexOf(b)>-1?!0:!1;case"b":return la.indexOf(b)>-1?!0:!1;case"bdo":return ia.indexOf(b)>-1?!0:["dir","lang"].indexOf(b)>-1?!0:!1;case"big":return la.indexOf(b)>-1?!0:!1;case"blockquote":return la.indexOf(b)>-1?!0:["cite"].indexOf(b)>-1?!0:!1;case"br":return ia.indexOf(b)>-1?!0:["clear"].indexOf(b)>-1?!0:!1;case"caption":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"center":return la.indexOf(b)>-1?!0:!1;case"cite":return la.indexOf(b)>-1?!0:!1;case"code":return la.indexOf(b)>-1?!0:!1;case"col":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["span","valign","width"].indexOf(b)>-1?!0:!1;case"colgroup":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["valign"].indexOf(b)>-1?!0:!1;case"dd":return la.indexOf(b)>-1?!0:!1;case"del":return la.indexOf(b)>-1?!0:["cite","datetime"].indexOf(b)>-1?!0:!1;case"dfn":return la.indexOf(b)>-1?!0:!1;case"div":return["evernote_attachment_url","evernote_attachment_name","evernote_attachment_mime"].indexOf(b)>-1?!0:la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"dl":return la.indexOf(b)>-1?!0:["compact"].indexOf(b)>-1?!0:!1;case"dt":return la.indexOf(b)>-1?!0:!1;case"em":return la.indexOf(b)>-1?!0:!1;case"font":return ia.indexOf(b)>-1||ja.indexOf(b)>-1?!0:["color","face","size"].indexOf(b)>-1?!0:!1;case"h1":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"h2":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"h3":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"h4":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"h5":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"h6":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"hr":return la.indexOf(b)>-1?!0:["align","noshade","size","width"].indexOf(b)>-1?!0:!1;case"i":return la.indexOf(b)>-1?!0:!1;case"img":return la.indexOf(b)>-1?!0:["align","alt","border","height","hspace","ismap","longdesc","name","src","usemap","vspace","width"].indexOf(b)>-1?!0:!1;case"ins":return la.indexOf(b)>-1?!0:["cite","datetime"].indexOf(b)>-1?!0:!1;case"kbd":return la.indexOf(b)>-1?!0:!1;case"li":return la.indexOf(b)>-1?!0:["type","value"].indexOf(b)>-1?!0:!1;case"map":return ja.indexOf(b)>-1?!0:["name","title"].indexOf(b)>-1?!0:!1;case"ol":return la.indexOf(b)>-1?!0:["compact","start","type"].indexOf(b)>-1?!0:!1;case"p":return la.indexOf(b)>-1?!0:["align"].indexOf(b)>-1?!0:!1;case"pre":return la.indexOf(b)>-1?!0:["width"].indexOf(b)>-1?!0:!1;case"q":return la.indexOf(b)>-1?!0:["cite"].indexOf(b)>-1?!0:!1;case"s":return la.indexOf(b)>-1?!0:!1;case"samp":return la.indexOf(b)>-1?!0:!1;case"small":return la.indexOf(b)>-1?!0:!1;case"span":return la.indexOf(b)>-1?!0:!1;case"strike":return la.indexOf(b)>-1?!0:!1;case"strong":return la.indexOf(b)>-1?!0:!1;case"sub":return la.indexOf(b)>-1?!0:!1;case"sup":return la.indexOf(b)>-1?!0:!1;case"table":return la.indexOf(b)>-1?!0:["align","bgcolor","border","cellpadding","cellspacing","summary","width"].indexOf(b)>-1?!0:!1;case"tbody":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["valign"].indexOf(b)>-1?!0:!1;case"td":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["abbr","bgcolor","colspan","height","nowrap","rowspan","valign","width"].indexOf(b)>-1?!0:!1;case"tfoot":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["valign"].indexOf(b)>-1?!0:!1;case"th":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["abbr","bgcolor","colspan","height","nowrap","rowspan","valign","width"].indexOf(b)>-1?!0:!1;case"thead":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["valign"].indexOf(b)>-1?!0:!1;case"tr":return la.indexOf(b)>-1||ma.indexOf(b)>-1?!0:["bgcolor","valign"].indexOf(b)>-1?!0:!1;case"tt":return la.indexOf(b)>-1?!0:!1;case"u":return la.indexOf(b)>-1?!0:!1;case"ul":return la.indexOf(b)>-1?!0:["compact","type"].indexOf(b)>-1?!0:!1;case"var":return la.indexOf(b)>-1?!0:!1}}function b(a){return a=a.toUpperCase(),-1==ga.indexOf(a)}function c(a){var c=a.nodeName;return c=c.toUpperCase(),"INPUT"==c&&a.type&&"image"==a.type.toLowerCase()?"img":"BODY"==c?"div":"HTML"==c?"div":"FORM"==c?"div":"LABEL"==c?"span":"FIELDSET"==c?"div":"LEGEND"==c?"span":"IFRAME"==c?"div":"EMBED"==c?"div":"CANVAS"==c?"img":"VIDEO"==c?"img":"HIGHLIGHT"==c?"span":fa.indexOf(c)>-1?"div":b(c)&&-1==ea.indexOf(c)?"span":c.toLowerCase()}function d(a,b,c,d,e,g){try{S=g,S||(S=window),d&&X.push(d),_?log.warn("Called serialize while blocked. Added callback but won't change base element."):(_=!0,O=a,P=b,Q=c,R=e,f())}catch(h){M(null,h)}}function e(a){if(l(a)){if(da.length>=ca)return void log.warn("Hit style cap of "+ca+" styles. Stopping.");if(!a.cssRules&&a.href)return W.push({href:a.href,owner:a.ownerNode}),V++,da.push(a.href),T.push(a.href),void Browser.sendToExtension({name:"main_getTextResource",href:a.href});var b=a.cssRules,c=null;if(a.ownerNode&&a.ownerNode.dataset&&a.ownerNode.dataset.evernoteOriginatingUrl){var d=/(.+)\//.exec(a.ownerNode.dataset.evernoteOriginatingUrl);d&&(c=d[1])}for(var e=0;e<b.length;e++)if(b[e].type==CSSRule.IMPORT_RULE){if(!b[e].styleSheet)continue;var f=b[e].styleSheet.href;if(/^https?:\/\//.test(b[e].href)||/^\/\//.test(b[e].href)||c&&(f="/"===b[e].href[0]?c+b[e].href:c+"/"+b[e].href),-1!=da.indexOf(f))continue;W.push({href:f,owner:a.ownerNode}),V++,da.push(f),T.push(f),Browser.sendToExtension({name:"main_getTextResource",href:f})}else b[e].type==CSSRule.MEDIA_RULE&&l(b[e])&&W.push(b[e]);W.push(a)}}function f(){V=0,da=[],U={},ba=document.getElementsByTagName("base")[0];for(var a=0;a<S.document.styleSheets.length;a++)e(S.document.styleSheets[a]);0==V&&n(O)}function g(a,b,c){var d;return c=c.trim(),d=c.match(/^http/i)?c:c.match(/^\//)?a.replace(/^(.*?:\/\/[^\/]+).*$/,"$1")+c:a.replace(/^(.*\/)/,"$1")+c,d="url('"+d+"')"}function h(a,b){function c(){for(var a=[e],b=0;b<arguments.length;b++)a.push(arguments[b]);return g.apply(this,a)}var d=S.document.location.href.replace(/[^\/]+$/,""),e=b.replace(/[^\/]+$/,"");return d==e?a:(a&&(a=a.replace(/url\(["']?(.*?)["']?\)/g,c)),a)}function i(){pa||(pa=setInterval(function(){try{if(da.length>=ca)return j(),void n(O);a:for(var a=0;a<oa.length;a++)for(var b=oa[a][0],c=oa[a][1],d=0;d<S.document.styleSheets.length;d++){var f=S.document.styleSheets[d];if(f.ownerNode===b){W[c]=f,e(S.document.styleSheets[d]),oa.splice(a,1),V--;break a}}0==V&&(j(),n(O))}catch(g){M(null,g)}},100))}function j(){pa&&(clearInterval(pa),pa=0)}function k(a){try{var b=T.indexOf(a.href);if(-1==b){if(T.length)return}else T.splice(b,1);for(var c=0;c<W.length;c++){var d=W[c];if(d.href===a.href){var e=h(a.responseText,d.href),f=S.document.createElement("style");f.type="text/css",f.textContent=e,f.dataset.evernoteOriginatingUrl=d.href;for(var g=[],j=0;j<S.document.styleSheets.length;j++)g.push(S.document.styleSheets[j]);return d.owner&&d.owner.parentNode&&d.owner.parentNode!==S.document?d.owner.parentNode.insertBefore(f,d.owner):S.document.head.appendChild(f),Y.push(f),oa.push([f,c]),void i()}}}catch(k){M(null,k)}}function l(a){if(a.media&&a.media.length){for(var b=0;b<a.media.length;b++){var c=a.media[b].toLowerCase();if(c.match(/\bscreen\b/i)||c.match(/\ball\b/i))return!0}return!1}return!0}function m(){aa=[];for(var a=0;a<W.length;a++){var b=W[a];if(b.cssRules)for(var c=0;c<b.cssRules.length;c++){var d=b.cssRules[c];d.selectorText&&d.selectorText.match(/(:?:before)|(:?:after)/)&&aa.push(d)}}}function n(a){setTimeout(function(){try{m(),$=[],$.push({element:a,string:"",i:0,after:null}),u()}catch(b){M(null,b)}},300)}function o(a){return GlobalUtils.escapeXML(a)}function p(a){return"string"==typeof a.id&&"movie_player"==a.id&&S.document.location.href.match(/v=(.*?)(&|$)/)}function q(a){if(p(a)){var b=S.document.location.href.match(/v=(.*?)(&|$)/)[1];return'<a href="'+GlobalUtils.escapeXML(S.document.location.href)+'" target="_blank"><img src="http://img.youtube.com/vi/'+b+'/0.jpg"></img></a>'}return""}function r(a){try{if("application/x-shockwave-flash"===a.getAttribute("type")&&a.getAttribute("flashvars")){var b=/iurlsd=(.+?)(&|$)/.exec(a.getAttribute("flashvars"));if(b||(b=/iurl=(.+?)(&|$)/.exec(a.getAttribute("flashvars"))),b&&(a.style.backgroundImage="url("+decodeURIComponent(b[1])+")",a.style.backgroundPosition="50%",a.style.backgroundRepeat="no-repeat"),b=/video_id=(.+?)(&|$)/.exec(a.getAttribute("flashvars"))){var c=document.createElement("a");c.href="https://www.youtube.com/watch?v="+b[1],c.target="_blank",c.style.display="block",c.style.width="100%",c.style.height="100%",a.appendChild(c)}}}catch(d){log.warn("problem with adding pic to embedded youtube video")}}function s(a){if("iframe"!=a.nodeName.toLowerCase())return null;var b="";if(a.dataset&&a.dataset.en_id&&R&&R[a.dataset.en_id]){b=R[a.dataset.en_id];var c=G(a);a.width&&(c.map.width={value:a.width+"px"}),a.height&&(c.map.height={value:a.height+"px"}),c.map.position&&"static"!==c.map.position.value||(c.map.position={value:"relative"});var d="";for(var e in c.map)d+=e+":"+c.map[e].value+";";d=d?' style="'+N(d)+'"':"";var f="<div"+d+">"+b+"</div>";return f}return null}function t(a){if(a.parentNode&&a!=O){var b=a.parentNode.nodeName;if(b=b.toLowerCase(),"dl"==b){var d=c(a);if("dd"!=d&&"dt"!=d)return!1}}return!0}function u(){if(Z++,Z%500==0)return void setTimeout(function(){try{u()}catch(a){M(null,a)}},25);var d=$[$.length-1];if(d||M(""),0==d.i){if(!b(c(d.element)))return $.pop(),void u();if(!t(d.element))return log.warn('discarding invalid DL child "'+d.element.nodeName+'"'),$.pop(),void u();if(P&&d.element!=P.commonAncestorContainer&&!P.intersectsNode(d.element))return $.pop(),void u();if(P&&d.element===P.endContainer&&0===P.endOffset)return $.pop(),void u();if(["evernoteClipperResult","evernoteAuthTools","evernoteFilingTools","evernoteGlobalTools","evernoteUserTools","evernoteShareTools","evernoteEmailSharing","evernoteOptionsPage","evernoteClearlyArticle"].indexOf(d.element.id)>-1)return $.pop(),void u();var e=q(d.element);if(e)return d.string+=e,$.pop(),void($.length?($[$.length-1].string=d.string,u()):M(d.string));var f=s(d.element);if(f)return d.string+=f,$.pop(),void($.length?($[$.length-1].string=d.string,u()):M(d.string));var g={};if(Q&&(r(d.element),g="HIGHLIGHT"===d.element.nodeName?{style:' style="x-evernote:highlighted;background-color:#F6EE96;"'}:G(d.element),g.after&&(d.after=g.after)),g.map&&g.map.display&&"none"==g.map.display.value)return $.pop(),void u();var h=c(d.element);if(d.string+="<"+h,z(d.element),"CANVAS"==d.element.nodeName)try{d.string+=' src="'+d.element.toDataURL()+'"'}catch(i){}else"VIDEO"==d.element.nodeName&&d.element.poster&&(d.string+=' src="'+GlobalUtils.escapeXML(d.element.poster)+'"');if(d.element.attributes&&d.element.attributes.length)for(d.i=0;d.i<d.element.attributes.length;d.i++)!a(h,d.element.attributes[d.i].name)||"VIDEO"==d.element.nodeName&&"src"==d.element.attributes[d.i].name||(d.string+=" "+J(d.element,d.element.attributes[d.i]));Q&&"map"!=h?d.string+=g.style:"HIGHLIGHT"==d.element.nodeName&&(d.string+=' style="x-evernote:highlighted;background-color:#F6EE96;"'),d.string+=">",Q&&g.before&&(d.string+=g.before),d.i=0}for(;d.i<d.element.childNodes.length;)if(d.element.childNodes[d.i].nodeType==Node.TEXT_NODE){var j;j=P&&d.element.childNodes[d.i]===P.startContainer?o(d.element.childNodes[d.i].textContent.substr(P.startOffset)):P&&d.element.childNodes[d.i]===P.endContainer?o(d.element.childNodes[d.i].textContent.substr(0,P.endOffset)):P&&!P.intersectsNode(d.element.childNodes[d.i])?"":o(d.element.childNodes[d.i].textContent),d.string+=j,d.i++}else{if(d.element.childNodes[d.i].nodeType==Node.ELEMENT_NODE&&v(d.element))return $.push({element:d.element.childNodes[d.i],string:d.string,i:0,after:null}),d.i++,void u();d.i++}Q&&d.after&&(d.string+=d.after),d.string+="</"+c(d.element)+">",$.pop(),$.length?($[$.length-1].string=d.string,u()):M(d.string)}function v(a){return"VIDEO"==a.nodeName?!1:!0}function w(a){if(a["background-position"]&&a["background-repeat"]&&"0px 50%"==a["background-position"].trim()&&"initial initial"==a["background-repeat"].trim()){for(var b in a)b.match(/background/)&&delete a[b];a.background="0"}}function x(a){for(var b={},c=a.split(/;(?!.[^\(]+?\))\s*/),d=0;d<c.length;d++)if(c[d]=c[d].trim(),c[d]){var e=c[d].indexOf(":"),f=c[d].substr(0,e).trim(),g=c[d].substr(e+1).trim();if(f&&g){for(var h=new RegExp("(url\\(.+?\\))","g"),i=h.exec(g),j=g;i;){var k=i[1],l=k;/url\(.+?(data:.+?;.+?,.+?)\)/.test(l)&&(l="url("+/url\(.+?(data:.+?;.+?,.+?)\)/.exec(l)[1]+")"),/url\(\/\/(.+?)\)/.test(l)&&(l="url(http://"+/url\(\/\/(.+?)\)/.exec(l)[1]+")"),/url\((.+?)\)/.test(l)&&(l="url("+GlobalUtils.escapeXML(GlobalUtils.unescapeXML(/url\((.+?)\)/.exec(l)[1]))+")"),j=j.replace(k,l),i=h.exec(g)}g=j,b[f.toLowerCase()]=g}}return w(b),b}function y(a){var b={};if(a.style.cssText){var c;a.style.savedCssObj||(a.style.savedCssObj=x(a.style.cssText)),c=a.style.savedCssObj;for(var d in c)b[d]=c[d]}return b}function z(a){"img"==a.nodeName.toLowerCase()&&(a.attributes.width||a.setAttribute("width",a.width),a.attributes.height||a.setAttribute("height",a.height))}function A(a){a.style&&(a.hasAttribute("background")&&(a.style.backgroundImage="url("+a.getAttribute("background")+")"),a.hasAttribute("bgcolor")&&(a.style.backgroundColor=a.getAttribute("bgcolor")),a.hasAttribute("text")&&(a.style.color=a.getAttribute("text")))}function B(a){var b={ids:{regex:/#[A-Z]+/gi,count:0},classes:{regex:/\.[A-Z]+/gi,count:0},attrs:{regex:/\[.*?\]/g,count:0},pseudos:{regex:/:+[A-Z]+/gi,count:0},pseudoEls:{regex:/:+(first-line|first-letter|before|after)/gi,count:0},types:{regex:/(^|\s)[A-Z]+/gi,count:0}};for(var c in b)for(var d=b[c].regex;d.exec(a);)b[c].count++;b.pseudoClasses={},b.pseudoClasses.count=b.pseudos.count-b.pseudoEls.count;var e=b.ids.count,f=b.classes.count+b.attrs.count+b.pseudoClasses.count,g=b.types.count+b.pseudoEls.count,h=256*e*256+256*f+g;return h}function C(a){var b=[],c=0,d=0,e="";for(d=0;d<a.length;d++)e?a[d]==e&&(e=""):"'"==a[d]||'"'==a[d]?e=a[d]:","==a[d]&&(b.push(a.substring(c,d).trim()),c=d+1);return b.push(a.substr(c).trim()),b}function D(a){return qa[a.toLowerCase()]?!0:!1}function E(a,b){var c=a.nodeName.toLowerCase();("table"==c||"caption"==c)&&"CSS1Compat"==S.document.compatMode&&(b["font-size"]={value:"inherit",score:0},b["font-weight"]={value:"inherit",score:0},b["font-style"]={value:"inherit",score:0},b["font-variant"]={value:"inherit",score:0})}function F(a,b,c){var d={padding:{"delete":["padding-top","padding-bottom","padding-left","padding-right"]},margin:{"delete":["margin-top","margin-bottom","margin-left","margin-right"]},background:{"delete":["background-color","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","background-image"],further:["background-position","background-repeat"]},"background-position":{"delete":["background-position-x","background-position-y"]},"background-repeat":{"delete":["background-repeat-x","background-repeat-y"]},border:{"delete":["border-width","border-style","border-color"],further:["border-top","border-right","border-bottom","border-left"]},"border-top":{"delete":["border-top-width","border-top-style","border-top-color"]},"border-right":{"delete":["border-right-width","border-right-style","border-right-color"]},"border-bottom":{"delete":["border-bottom-width","border-bottom-style","border-bottom-color"]},"border-left":{"delete":["border-left-width","border-left-style","border-left-color"]}};if(d[a]){for(var e in d[a]["delete"])c[d[a]["delete"][e]]&&b>=c[d[a]["delete"][e]].score&&delete c[d[a]["delete"][e]];for(var e in d[a].further)c[d[a].further[e]]&&F(d[a].further[e],c[d[a].further[e]].score,c)}}function G(a,b){A(a);var c="",d=null,e={},f={};a.attributes&&a.attributes.style&&(d=x(a.attributes.style.value));var h={};E(a,h);var i;if(i=S.getMatchedCSSRules(a),i&&i.length)for(var j=0;j<i.length;j++){var k=0,l=!1;i[j].selectorText.match(/:visited/i)&&(l=!0);for(var m=C(i[j].selectorText),n=0;n<m.length;n++){var o;try{o=a.webkitMatchesSelector(m[n])}catch(p){log.warn("Couldn't match against selector "+m[n]+" in: "+i[j].selectorText),log.exception(p)}if(o){l=!1;var q=B(m[n]);q>=k&&(k=q)}}if(!l){var r=y(i[j]);if(r["counter-reset"]){var s=r["counter-reset"].split(/\s+/);if(s.length>0)for(var t=0;t<s.length;)/^\d+$/.test(s[t+1])?(U[s[t]]=parseInt(s[t+1]),t+=2):U[s[t++]]=0}if(r["counter-increment"]){var u=r["counter-increment"].split(/\s+/);if(u.length>0)for(var v=0;v<u.length;)U[u[v]]||(U[u[v]]=0),/^\d+$/.test(u[v+1])?(U[u[v]]+=parseInt(u[v+1]),v+=2):U[u[v++]]++}for(var w in r){var z=w.replace(/^-/,"").replace(/-[a-z]/g,function(a){return a[1].toUpperCase()});if(i[j].style[z]&&"counterIncrement"!==z&&"counterReset"!==z){var G=0;h[w]&&(G=h[w].score);var J=k;r[w].match(/!important\s*$/i)&&(J+=16777216,r[w]=r[w].replace(/\s*!important\s*$/i,"")),J>=G&&(F(w,J,h),h[w]={value:r[w],score:J})}}}}for(var j=0;j<aa.length;j++){var K,L=aa[j];if(a.webkitMatchesSelector)try{K=a.webkitMatchesSelector(L.selectorText.replace(/(:?:before)|(:?:after)/g,""))}catch(p){}if(K){var M=!1,P=!1;L.selectorText.match(/:?:before/)&&(M=!0),L.selectorText.match(/:?:after/)&&(P=!0);for(var w in h)M&&D(w)&&(e[w]=h[w].value),P&&D(w)&&(f[w]=h[w].value);var Q=y(L);for(var w in Q)M&&(e[w]=Q[w]),P&&(f[w]=Q[w])}}for(var R=[e,f],T=0;T<R.length;T++){var V=R[T],W="",X="",Y=0;if(V["counter-reset"])for(var s=V["counter-reset"].split(/\s+/),t=0;t<s.length;)/^\d+$/.test(s[t+1])?(U[s[t]]=parseInt(s[t+1]),t+=2):U[s[t++]]=0;if(V["counter-increment"])for(var u=V["counter-increment"].split(/\s+/),v=0;v<u.length;)U[u[v]]||(U[u[v]]=0),/^\d+$/.test(u[v+1])?(U[u[v]]+=parseInt(u[v+1]),v+=2):U[u[v++]]++;for(var n in V){if("content"==n){var X=V[n];if(X=X.trim(),X=X.replace(/\s+!important$/,""),"none"==X&&(X='""'),X.match(/^'/)?X=X.replace(/^'(.*?)'.*/,"$1"):X.match(/^"/)&&(X=X.replace(/^"(.*?)".*/,"$1")),X.match(/^url\((.*)\)/)){var Z=X.match(/^url\((.*)\)/)[1];X="<img src='"+Z+"'></img>"}else if(X.match(/^\s*counter\(.*?\)/)){var $=X.match(/^\s*counter\((.*?)\)/)[1].split(",")[0];"number"==typeof U[$]&&(X=GlobalUtils.escapeXML(""+U[$]))}else if(X.match(/^\s*attr\((.*?)\)/)){var _=X.match(/^\s*attr\((.*?)\)/)[1];X=a.getAttribute(_)?GlobalUtils.escapeXML(""+a.getAttribute(_)):""}else X.match(/^\s*-webkit-image-set\(.+\)/)?(W+="background:"+X+";",X=""):X=GlobalUtils.escapeXML(X)}else"counter-reset"!==n&&"counter-increment"!==n&&(W+=n+":"+V[n]+";");Y++}Y&&(W='<span style="'+W+'">'+X+"</span>",0==T?e=W:f=W)}if("string"!=typeof e&&(e=null),"string"!=typeof f&&(f=null),a==O&&(b=na),b)for(var j=0;j<b.length;j++)h[b[j]]&&delete h[b[j]];if(H(a,h),I(h),d){var ca=/url\(['"]?(.*?)['"]?\)/i;for(var w in d){if(ca.test(d[w])){var da=ca.exec(d[w])[1],ea=S.document.location.href;ba&&ba.href&&(ea=ba.href);var fa=g(ea,K,da);d[w]=d[w].replace('url("'+da+'")',fa).replace("url('"+da+"')",fa).replace("url("+da+")",fa)}h[w]={value:d[w]}}}var ga=Object.keys(h);ga.sort(function(a,b){var c=h[a],d=h[b];return c.score>d.score});for(var j in ga)c+=ga[j]+":"+h[ga[j]].value+";";return c=c?' style="'+N(c)+'"':"",{style:c,before:e,after:f,map:h}}function H(a,b){if(b.height&&b.height.value.match(/%$/)){var c=b.height.value;try{if("fixed"!=S.getComputedStyle(a).position){var d=S.getComputedStyle(a.parentNode).height;d||(c="auto")}}catch(e){}b.height.value=c}}function I(a){for(var b=["-webkit-user-select","-moz-user-select","-ms-user-select","user-select","-webkit-user-modify","-moz-user-modify","-ms-user-modify","user-modify"],c=0;b>c;c++)a[b[c]]&&delete a[b[c]]}function J(a,b){var c=null;if("href"==b.name.toLowerCase()){var d=a.href.animVal?a.href.animVal:a.href;d&&d.match(/^javascript/i)?d="#":/^https?:\/\//.test(d)||(d=a.baseURI+d),c=N(d)}else if("src"==b.name.toLowerCase()){var e=a.src;""==b.value.trim()&&(e=""),e&&e.match(/^javascript/i)&&(e="#"),e=K(a,e),c=N(e)}return null===c&&(c=N(b.value.replace(/\u000A/g,""))),b.name+'="'+c+'"'}function K(a,b,c){if(!a)return b;var d=S||window;if("IMG"!=a.nodeName||!/^https?:\/\//i.test(b)||/\.gif($|\?)/i.test(b)||!a.naturalWidth&&!a.naturalHeight||SAFARI&&/Version\/(6\.2\.4\s|7\.1[\s\.]|8\.)/.test(navigator.userAgent)&&b===d.location.href)return a.naturalWidth&&a.naturalHeight?b:"";var e=/^(https?:\/\/.[^\/]+)\/?/.exec(b)[1];if(e!==d.document.location.origin)return b;var f=d.document.createElement("canvas");f.width=(c?a.naturalWidth:a.width)||1,f.height=(c?a.naturalHeight:a.height)||1,f.getContext("2d").drawImage(a,0,0,c?a.naturalWidth:a.width,c?a.naturalHeight:a.height);try{return f.toDataURL(/\.jpe?g$/.test(b)?"image/jpeg":"image/png")}catch(g){if(18!=g.code)throw g;return b}finally{f=null}}function L(){for(var a="",d="",e=O.parentNode;e&&e.parentNode;){var f=G(e,na).style,g=c(e);b(g)&&(a="<"+g+f+">"+a,d=d+"</"+g+">"),e=e.parentNode}return a='<div style="font-size: 16px">'+a,d+="</div>",{front:a,back:d}}function M(a,b){if(_=!1,!b){var c={front:"",back:""};Q&&(c=L()),a=c.front+a+c.back}for(var d=0;d<Y.length;d++)Y[d].parentNode.removeChild(Y[d]);Y=[];for(var d=0;d<X.length;d++)try{X[d](a,b)}catch(e){log.warn("Couldn't run 'serialize' callback: "+e.stack||e.trace)}X=[]}function N(a){return a?GlobalUtils.escapeXML(a):""}var O,P,Q,R,S,T=[],U={},V=0,W=[],X=[],Y=[],Z=0,$=[],_=!1,aa=[],ba=null,ca=100,da=[],ea=["A","ABBR","ACRONYM","ADDRESS","AREA","B","BDO","BIG","BLOCKQUOTE","BR","CAPTION","CENTER","CITE","CODE","COL","COLGROUP","DD","DEL","DFN","DIV","DL","DT","EM","FONT","H1","H2","H3","H4","H5","H6","HR","I","IMG","INS","KBD","LI","MAP","OL","P","PRE","Q","S","SAMP","SMALL","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","TT","U","UL","VAR"],fa=["ARTICLE","ASIDE","DETAILS","FOOTER","FIGURE","FIGCAPTION","HEADER","HGROUP","NAV","SECTION","SUMMARY"],ga=["APPLET","BASE","BASEFONT","BGSOUND","BLINK","BODY","BUTTON","DIR","EMBED","FIELDSET","FORM","FRAME","FRAMESET","HEAD","HTML","IFRAME","ILAYER","INPUT","ISINDEX","LABEL","LAYER","LEGEND","LINK","MARQUEE","MENU","META","NOEMBED","NOFRAMES","NOSCRIPT","OBJECT","OPTGROUP","OPTION","PARAM","PLAINTEXT","SCRIPT","SELECT","STYLE","TEXTAREA","TITLE","XML"],ha=["id","class","accesskey","data","dynsrc","tabindex","style"],ia=["style","title"],ja=["lang","xml:lang","dir"],ka=["accesskey","tabindex"],la=["style","title","lang","xml:lang","dir"],ma=["align","char","charoff"],na=["border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","bottom","clear","display","float","height","layout-flow","layout-grid","layout-grid-char","layout-grid-char-spacing","layout-grid-line","layout-grid-mode","layout-grid-type","left","margin","margin-bottom","margin-left","margin-right","margin-top","max-height","max-width","min-height","min-width","padding","padding-bottom","padding-left","padding-right","padding-top","position","right","size","table-layout","top","visibility","width","z-index"];Browser.addMessageHandlers({content_textResource:k});var oa=[],pa=0,qa={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,color:!0,cursor:!0,direction:!0,"empty-cells":!0,"font-family":!0,"font-size":!0,"font-style":!0,"font-variant":!0,"font-weight":!0,font:!0,"letter-spacing":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,"list-style":!0,orphans:!0,quotes:!0,"text-align":!0,"text-indent":!0,"text-transform":!0,visibility:!0,"white-space":!0,widows:!0,"word-spacing":!0};this.convertImgSrcToBase64IfPossible=K,this.serialize=d,Object.preventExtensions(this)}if("undefined"==typeof SAFARI&&(SAFARI=!1),"undefined"==typeof Browser){Browser={},Browser.sendToExtension=function(a){window.parent.postMessage(a,"*")};var msgMap={},msgHandler=function(a){var b=a.data;b&&b.name&&msgMap[b.name]&&msgMap[b.name](a.data)};window.addEventListener("message",msgHandler,!1),Browser.addMessageHandlers=function(a){for(var b in a)msgMap[b]=a[b]}}Object.preventExtensions(HtmlSerializer);