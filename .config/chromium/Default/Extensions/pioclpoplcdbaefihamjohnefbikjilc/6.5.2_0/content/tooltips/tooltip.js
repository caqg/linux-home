/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function closeFrame(){Browser.sendToExtension({name:"bounce",message:{name:"ttc_close",which:NAME}})}function setHeight(){setTimeout(function(){Browser.sendToExtension({name:"bounce",message:{name:"ttc_setHeight",which:NAME,height:document.getElementById("main").offsetHeight}})},500)}function ssoDone(){Browser.sendToExtension({name:"ssoComplete"}),closeFrame()}var NAME,authed=!1,REFRESH_PAGE_ERROR="The Clipper couldn't start on this page. Reload the page and try again. If that doesn't help, contact customer support.";window.addEventListener("DOMContentLoaded",function(){for(var a=/(?:^#|&)([^=]+)=([^&]+)/g,b=a.exec(window.location.hash);b;)"which"===b[1]?NAME=b[2]:"locale"===b[1]&&/china/i.test(b[2])?document.body.classList.add("china"):"authed"===b[1]?("true"===b[2]&&(authed=!0),authed||document.body.classList.add("unauthed")):window[b[1]]=b[2],b=a.exec(window.location.hash);GlobalUtils.localize(document.body),document.body.classList.add(NAME),document.getElementById("close").addEventListener("click",function(){"ssoInProgress"===NAME?ssoDone():"gmailTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_x_closed"}),closeFrame()):"pdfTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:"tooltip_x_closed"}),closeFrame()):"wsj"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"wsj",label:"tooltip_x_closed"}),closeFrame()):"customTooltip"===NAME&&(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"tooltip_x_closed"}),closeFrame())}),"gmailTooltip"===NAME?(document.getElementById("gmailButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},function(){alert(REFRESH_PAGE_ERROR)}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_shown"})):"pdfTooltip"===NAME?(document.getElementById("pdfButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},function(){alert(REFRESH_PAGE_ERROR)}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:"tooltip_shown"})):"ssoInProgress"===NAME?(document.getElementById("ssoLink").addEventListener("click",function(){Browser.sendToExtension({name:"openSSOPage"})}),document.getElementById("ssoClose").addEventListener("click",ssoDone)):"customTooltip"===NAME&&(document.getElementById("customButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},function(){alert(REFRESH_PAGE_ERROR)}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"tooltip_shown"}),document.querySelector("#customTooltip .details").textContent=Browser.i18n.getMessage("topSitesTooltipBodyPart1",[Browser.i18n.getMessage(window.customSiteName)]),setHeight())});