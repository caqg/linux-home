/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function countSerializableFrames(){for(var a=document.getElementsByTagName("iframe"),b=0,c=0;c<a.length;c++)a[c].dataset&&a[c].dataset.en_id&&b++;return b}function completedFrameCount(){var a=0;for(var b in frameData)a++;return a}if(window==window.parent){var frameData={},completed=!1,addedEventListeners=!1,timeout,serializeFrames=function(a){function b(){completed||(log.warn("Some frames seem stuck, continuing with what we've got."),completed=!0,a(frameData))}return 0==countSerializableFrames()?void a(null):(addedEventListeners||(window.addEventListener("message",function(c){c&&c.data&&c.data.name&&"EN_serialized"==c.data.name?(frameData[c.data.id]=c.data.data,clearTimeout(timeout),completed||(completedFrameCount()==countSerializableFrames()?(completed=!0,a(frameData)):timeout=setTimeout(b,2e3))):c&&c.data&&c.data.name&&"main_getTextResource"==c.data.name&&Browser.sendToExtension({name:"main_getTextResource",href:c.data.href})},!1),addedEventListeners=!0),frameData={},completed=!1,timeout=setTimeout(b,2e3),void Browser.sendToExtension({name:"bounce",message:{name:"startSerialize"}}))};Browser.addMessageHandlers({content_textResource:function(a){window.postMessage(a,"*")}})}else Browser.addMessageHandlers({startSerialize:function(){script=document.createElement("script"),script.type="text/javascript",script.textContent="serializeFrame();",document.head.appendChild(script)}},!0);var addedScripts=!1;Browser.addMessageHandlers({insertSerializationScripts:function(){if(window!=window.parent&&(addedScripts||(document.head&&!document.querySelector("script[src='"+Browser.extension.getURL("js/GlobalUtils.js")+"']")&&(a=document.createElement("script"),a.type="text/javascript",a.src=Browser.extension.getURL("js/GlobalUtils.js"),document.head.appendChild(a)),document.head&&!document.querySelector("script[src='"+Browser.extension.getURL("content/HtmlSerializer.js")+"']")&&(a=document.createElement("script"),a.type="text/javascript",a.src=Browser.extension.getURL("content/HtmlSerializer.js"),document.head.appendChild(a)))),!addedScripts&&document.head&&!document.querySelector("script[src='"+Browser.extension.getURL("content/frame.js")+"']")){var a=document.createElement("script");a.type="text/javascript",a.src=Browser.extension.getURL("content/frame.js"),document.head.appendChild(a),addedScripts=!0}}},!0);