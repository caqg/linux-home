/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function LozengeInput(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!n(a.id)){var b=(a.name||a.id).trim();if(b){var c=document.createElement("div");c.classList.add("loz_lozenge"),c.textContent=b,c.dataset.id=a.id,t.appendChild(c),c.addEventListener("click",function(){for(var a=t.getElementsByClassName("selected");a.length;)a[0].classList.remove("selected");this.classList.add("selected"),this.offsetLeft<t.scrollLeft?t.scrollLeft=this.offsetLeft:this.offsetLeft+this.offsetWidth>t.offsetWidth+t.scrollLeft&&(t.scrollLeft=this.offsetLeft+this.offsetWidth-t.offsetWidth)}),s[a.id]=a,v.placeholder="",t.scrollLeft=t.scrollWidth-t.offsetWidth,d()}}}function j(a){i(a),v.value="",clearTimeout(r)}function k(){for(var a=t.getElementsByClassName("selected");a.length;)a[0].classList.remove("selected");t.scrollLeft=t.scrollWidth-t.offsetWidth}function l(){v.focus()}function m(){var a=[];for(var b in s)a.push(s[b]);return a}function n(a){return null!==s[a]&&void 0!==s[a]}function o(a){a&&a.parentNode&&(delete s[a.dataset.id],a.parentNode.removeChild(a),t.scrollLeft=t.scrollWidth-t.offsetWidth,e(),t.children.length?d():(v.placeholder=b,p()))}function p(){r=setTimeout(function(){c(v.value)},300)}function q(a,b){if(delete s[a],n(b.id)){for(var c=0;c<t.children.length;c++)if(t.children[c].dataset.id==a){o(t.children[c]);break}}else{s[b.id]=b;for(var c=0;c<t.children.length;c++)if(t.children[c].dataset.id==a){t.children[c].dataset.id=b.id,t.children[c].textContent=b.name;break}}}var r,s={},t=document.createElement("div");t.classList.add("loz_existing");var u=document.createElement("div");u.classList.add("loz_inputContainer");var v=document.createElement("input");v.classList.add("loz_input"),v.tabIndex=1,v.autofocus=!0,b&&(v.placeholder=b),v.addEventListener("keydown",function(a){if(8===a.keyCode||37===a.keyCode){if(0===this.selectionStart&&this.selectionStart===this.selectionEnd&&t.children.length){this.blur();for(var b=t.getElementsByClassName("selected");b.length;)b.classList.remove("selected");t.lastElementChild.classList.add("selected")}}else 38===a.keyCode?(g(),a.preventDefault()):40===a.keyCode?(h(),a.preventDefault()):13!==a.keyCode&&9!==a.keyCode||!f(this.value)||j({id:this.value})}),v.addEventListener("input",function(){clearTimeout(r),v.value?p():t.children.length?d():p()}),v.addEventListener("focus",k),window.addEventListener("keydown",function(a){if(a.srcElement!==v){var b=t.getElementsByClassName("selected");if(b.length)if(8===a.keyCode)o(b[0]),v.focus();else if(37===a.keyCode){var c=b[0].previousElementSibling;c&&(b[0].classList.remove("selected"),c.classList.add("selected"),t.scrollLeft>c.offsetLeft&&(t.scrollLeft=c.offsetLeft))}else if(39===a.keyCode){var d=b[0].nextElementSibling;b[0].classList.remove("selected"),d?(d.classList.add("selected"),d.offsetLeft+d.offsetWidth>t.offsetWidth+t.scrollLeft&&(t.scrollLeft=d.offsetLeft+d.offsetWidth-t.offsetWidth)):v.focus()}}}),window.addEventListener("click",function(a){t.contains(a.srcElement)||k()}),a.appendChild(t),u.appendChild(v),a.appendChild(u),this.addLozengeAndClearInput=j,this.blurExistingLozenges=k,this.focus=l,this.getLozenges=m,this.hasLozenge=n,this.input=v,this.updateExistingLozenge=q,Object.preventExtensions(this)}Object.preventExtensions(LozengeInput);