/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function NoteSnippets(a,b,c,d,e,f,g,h){"use strict";function i(a,b){a&&(s=a),t=b,s&&0!=s.length&&j()}function j(){l(s)}function k(){}function l(b){var c=a;if(c){c.innerHTML="";var d;for(var e in b){g||e%3!=0||(d=document.createElement("div"),d.className="row",c.appendChild(d));var f=document.createElement("div");f.className="container",f.appendChild(p(b[e],e));var h=q(b[e]);h&&f.appendChild(h),g?c.appendChild(f):d.appendChild(f)}t&&t>b.length&&c.appendChild(m())}}function m(){var a,c=t-s.length;a=1==c?Browser.i18n.getMessage("popup_oneMoreNoteLink"):Browser.i18n.getMessage("popup_moreNotesLink",[c]);var d=document.createElement("div");return d.className="moreOnServer",d.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});var a=Browser.extension.getURL("js/main/generateUrlWithTempToken.html?baseUrl="+encodeURIComponent(b)+"&targetUrl="+encodeURIComponent("/Home.action#x="+f));Browser.sendToExtension({name:"main_openTab",url:a})}),d.innerHTML=a,d}function n(a){var b=navigator.language,c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],e=new Date,f="%day %monthName %year",g="%monthName %day, %year",h="%year\u5e74%month\u6708%day\u65e5",i="%year\u5e74%monthName%day\u65e5";if(a.getMonth()===e.getMonth()&&a.getDate()===e.getDate()&&a.getFullYear()===e.getFullYear())return Browser.i18n.getMessage("Today");if(e.valueOf()-a.valueOf()<=6048e5&&e.getDay()!==a.getDay())return Browser.i18n.getMessage(c[a.getDay()]);var j=f,k=a.getDate();return b.match(/en-us/i)&&(j=g,k+=1==k||21==k||31==k?"st":2==k||22==k?"nd":3==k||23==k?"rd":"th"),b.match(/^zh/i)?j=h:b.match(/^ja/i)&&(j=i),j=j.replace(/%day/,k),j=j.replace(/%year/,a.getFullYear()),j=j.replace(/%monthName/,Browser.i18n.getMessage(d[a.getMonth()])),j=j.replace(/%month/,a.getMonth()+1)}function o(b){var c=a.querySelector("img[guid='"+b.guid+"']");c&&(c.src=b.datauri,c.removeAttribute("guid"))}function p(a){var f,g=document.createElement("div"),i=document.createElement("a");if(i.className="noteLink","expert"==a.type?(g.className="expert",i.target="_parent",i.href="evernote://business/user/"+a.id,g.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(!0,!0)})):(g.className="noteBlock",i.target="_blank",i.href=GlobalUtils.getNoteURI(b,{shardId:a.shardId||d,noteGuid:a.guid},c,e.pers),g.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(a.inBusinessNotebook)})),"expert"==a.type)f=document.createElement("img"),f.className="smallimage",f.setAttribute("guid",a.id),Browser.sendToExtension({name:"downloadThumbnail",guid:a.id,method:"GET",size:60,url:b+"/user/"+a.id+"/photo"});else if(a.thumbsquare){var j=110;devicePixelRatio>=1.5&&(j*=2),f=document.createElement("img"),a.snippet&&(j=60,devicePixelRatio>=1.5&&(j*=2),f.className="smallimage"),f.setAttribute("guid",a.guid),Browser.sendToExtension({name:"downloadThumbnail",guid:a.guid,inBusinessNotebook:a.inBusinessNotebook,size:j,url:b+a.thumbsquare,type:"note"})}var k=document.createElement("div");if(k.className="snippet",a.snippet){var l=document.createElement("p");l.innerHTML=a.snippet,l.className="snippettext",a.thumbsquare&&(l.className+=" mixed")}var m=document.createElement("h1");if(m.textContent=a.title,"expert"==a.type){k.appendChild(f);var o=document.createElement("div");if(o.className="divider",k.appendChild(o),k.appendChild(m),a.role){var p=document.createElement("div");p.textContent=a.role,p.className="role",k.appendChild(p)}var q=document.createElement("a");q.className="seeMoreLink",q.textContent=Browser.i18n.getMessage("seeMore"),k.appendChild(q)}else{var r=document.createElement("p"),s=new Date(a.updated);r.textContent=n(s),r.className="date",k.appendChild(m),k.appendChild(r),a.snippet&&k.appendChild(l),a.thumbsquare&&k.appendChild(f)}return g.appendChild(k),g.appendChild(i),g}function q(a){if(a.contact||a.notebookName){u=!0;var b=document.createElement("div");return b.className=a.contact?"contactName":"notebookName",b.innerText=a.contact||a.notebookName,b.title=b.innerText,b}return null}function r(){return u}var s,t=0,u=!1;i(),this.setNotes=i,this.show=k,this.renderBlocks=l,this.hasAtLeastOneNotebookName=r,Browser.addMessageHandlers({receiveThumbnail:o}),Object.preventExtensions(this)}Object.preventExtensions(NoteSnippets);