/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function ReminderSetter(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=document.querySelector("#date span.focused");if(b){clearTimeout(v);var c=parseInt(r.innerText||r.textContent),d=parseInt(p.innerText||p.textContent)-1,e=parseInt(q.innerText||q.textContent);if("Up"==a.keyIdentifier)b===r?z.selectDate(new Date(c+1,d,e),"year"):b===p?z.selectDate(new Date(c,d+1,e),"month"):b===q?z.selectDate(new Date(c,d,e+1),"date"):b===s?(hour=(hour+1)%24,z.selectDate(new Date(c,d,e),"hour")):b===t?(minute=(minute+1)%60,z.selectDate(new Date(c,d,e),"minute")):b===u&&(hour=(hour+12)%24,z.selectDate(new Date(c,d,e),"meridian"));else if("Right"==a.keyIdentifier)b.nextElementSibling&&b.nextElementSibling.click();else if("Down"==a.keyIdentifier)b===r?z.selectDate(new Date(c-1,d,e),"year"):b===p?z.selectDate(new Date(c,d-1,e),"month"):b===q?z.selectDate(new Date(c,d,e-1),"date"):b===s?(hour=(hour-1+24)%24,z.selectDate(new Date(c,d,e),"hour")):b===t?(minute=(minute-1+60)%60,z.selectDate(new Date(c,d,e),"minute")):b===u&&(hour=(hour-12+24)%24,z.selectDate(new Date(c,d,e),"meridian"));else if("Left"==a.keyIdentifier)b.previousElementSibling&&b.previousElementSibling.click();else if(a.keyCode>=48&&a.keyCode<=57||a.keyCode>=96&&a.keyCode<=105){var f=a.keyCode%48;if(a.keyCode>57&&(f=a.keyCode%96),b===r)r.innerText.length<3?(r.innerText+=f,v=setTimeout(function(){z.selectDate(new Date(parseInt(r.innerText||r.textContent),d,e))},500)):3==r.innerText.length?(r.innerText+=f,z.selectDate(new Date(parseInt(r.innerText||r.textContent),d,e))):(r.innerText=f,v=setTimeout(function(){z.selectDate(new Date(parseInt(r.innerText||r.textContent),d,e))},500));else if(b===p)p.innerText.length<2?-1==d?(p.innerText=f,z.selectDate(new Date(c,f-1,e))):3>f?(p.innerText+=f,z.selectDate(new Date(c,parseInt(p.innerText||p.textContent)-1,e))):v=setTimeout(function(){z.selectDate(new Date(c,d,e))},500):(p.innerText=f,f>1?z.selectDate(new Date(c,f-1,e)):v=setTimeout(function(){var a=parseInt(p.innerText||p.textContent)-1;a=0>a?d:a,z.selectDate(new Date(c,a,e))},500));else if(b===q)q.innerText.length<2?2>e?(q.innerText+=f,z.selectDate(new Date(c,d,parseInt(q.innerText||q.textContent)))):new Date(c,d,10*e+f).getDate()==10*e+f?(q.innerText+=f,z.selectDate(new Date(c,d,parseInt(q.innerText||q.textContent)))):v=setTimeout(function(){z.selectDate(new Date(c,d,e))},500):(q.innerText=f,f>3?z.selectDate(new Date(c,d,parseInt(q.innerText||q.textContent))):v=setTimeout(function(){z.selectDate(new Date(c,d,parseInt(q.innerText||q.textContent)))},500));else if(b===s)if(s.innerText.length<2){var g=parseInt(s.innerText);0==g?(hour=f,z.selectDate(new Date(c,d,e))):1==g&&(3>f?(hour=10+f,z.selectDate(new Date(c,d,e))):v=setTimeout(function(){hour=1,z.selectDate(new Date(c,d,e))},500))}else 2>f?(s.innerText=f,v=setTimeout(function(){0!=f&&(hour=f),z.selectDate(new Date(c,d,e))},500)):(hour=f,z.selectDate(new Date(c,d,e)));else if(b===t)if(t.innerText.length<2){var g=parseInt(t.innerText);minute=10*g+f,z.selectDate(new Date(c,d,e))}else 6>f?(t.innerText=f,v=setTimeout(function(){0!=f&&(minute=f),z.selectDate(new Date(c,d,e))},500)):(minute=f,z.selectDate(new Date(c,d,e)))}else(65==a.keyCode||80==a.keyCode)&&b===u&&(("AM"==u.innerText&&80==a.keyCode||"PM"==u.innerText&&65==a.keyCode)&&(hour=(hour+12)%24),z.selectDate(new Date(c,d,e)))}}function k(){var a=n.querySelector("#date span.focused");a&&a.classList.remove("focused"),this.classList.add("focused")}function l(a,b){var c=new Date(a.year,a.month,a.date,hour,minute,0,0);if(x.innerHTML=z.format(c),p=document.getElementById("selectedMonth"),q=document.getElementById("selectedDate"),r=document.getElementById("selectedYear"),s=document.getElementById("selectedHour"),t=document.getElementById("selectedMinute"),u=document.getElementById("selectedMeridian"),p.addEventListener("click",k),q.addEventListener("click",k),r.addEventListener("click",k),s.addEventListener("click",k),t.addEventListener("click",k),u.addEventListener("click",k),b)switch(b){case"year":r.click();break;case"month":p.click();break;case"date":q.click();break;case"hour":s.click();break;case"minute":t.click();break;case"meridian":u.click()}return c}function m(){if(g(),a.classList.contains("added")?(z.selectedDate()||n.classList.remove("hasDate"),z.showTodayOrSelected()):(a.classList.add("added"),w=Date.now(),Browser.sendToExtension({name:"setReminder",shardId:c,token:b,noteGuid:d,title:e,sourceURL:f,reminderOrder:w}),i(ReminderSetter.REMINDER_TYPES.NO_DATE)),n.classList.toggle("visible"))a.classList.add("changingDate");else{a.classList.remove("changingDate");var h=n.querySelector("#date span.focused");h&&h.classList.remove("focused")}}var n=document.createElement("div");n.id="remindersSetter",n.innerHTML='<div id="noDate"><div class="reminderHeader">'+Browser.i18n.getMessage("reminderAdded")+'</div><div id="addDate" class="reminderButton">'+Browser.i18n.getMessage("addDate")+'</div></div><div id="hasDate"><div class="reminderHeader">'+Browser.i18n.getMessage("notifyMe")+'</div><div id="tomorrow" class="reminderButton">'+Browser.i18n.getMessage("tomorrow")+'</div><div id="nextWeek" class="reminderButton">'+Browser.i18n.getMessage("nextWeek")+'</div><div id="date"></div><div id="datePicker"></div></div>',a.parentNode.insertBefore(n,a.nextElementSibling);var o=Math.min(255,456-a.offsetLeft-38);o+130<456-a.offsetLeft+5?(n.style.left=Math.max(5,a.offsetLeft-38)+"px",n.style.webkitTransformOrigin=a.offsetLeft+9+"px 0"):(n.style.right=o+"px",n.style.webkitTransformOrigin="-webkit-calc(100% - "+(456-o-a.offsetLeft+9)+"px) 0");var p,q,r,s,t,u,v,w=null,x=document.getElementById("date"),y=!1,z=new DatePicker(document.getElementById("datePicker"),function(a,g){Browser.sendToExtension({name:"setReminder",token:b,shardId:c,noteGuid:d,title:e,sourceURL:f,reminderOrder:w,reminderTime:l(a,g)-0}),y||(y=!0,i(ReminderSetter.REMINDER_TYPES.CUSTOM_DATE))}),A=new Date;l({year:A.getFullYear(),month:A.getMonth(),date:A.getDate()});var B=document.getElementById("addDate"),C=document.querySelector("#noDate .reminderHeader");if(B.scrollWidth>B.clientWidth||C.scrollWidth>C.clientWidth||n.scrollHeight>n.clientHeight){var D=document.createElement("style");if(B.scrollWidth>B.clientWidth||C.scrollWidth>C.clientWidth){var E=Math.max(B.scrollWidth-B.clientWidth,C.scrollWidth-C.clientWidth);D.innerText="#remindersSetter { width: "+(112+E)+"px; }"}else n.scrollHeight>n.clientHeight&&(D.innerText="#remindersSetter { height: "+(165+n.scrollHeight-n.clientHeight)+"px; }");document.head.appendChild(D)}a.addEventListener("click",m),B.addEventListener("click",function(){g(),n.classList.add("hasDate")}),document.getElementById("tomorrow").addEventListener("click",function(){y||(y=!0,i(ReminderSetter.REMINDER_TYPES.TOMORROW));var a=new Date;a.setDate(a.getDate()+1),z.selectDate(a)}),document.getElementById("nextWeek").addEventListener("click",function(){y||(y=!0,i(ReminderSetter.REMINDER_TYPES.NEXT_WEEK));var a=new Date;a.setDate(a.getDate()+7),z.selectDate(a)}),n.addEventListener("click",function(a){if(!x.contains(a.srcElement)){var b=n.querySelector("#date span.focused");b&&b.classList.remove("focused")}}),n.addEventListener("webkitTransitionEnd",function(a){if("width"===a.propertyName&&!n.classList.contains("hasDate")&&n.scrollHeight>n.clientHeight){var b=document.createElement("style");b.innerText="#remindersSetter { height: "+(53+n.scrollHeight-n.clientHeight)+"px; }",document.head.appendChild(b)}else("height"===a.propertyName||"opacity"===a.propertyName)&&h()}),window.addEventListener("keydown",j),window.addEventListener("click",function(b){!n.classList.contains("visible")||n.contains(b.srcElement)||a.contains(b.srcElement)||m.call(a)}),this.__defineGetter__("height",function(){return n.classList.contains("visible")?n.offsetHeight+5:0}),this.__defineGetter__("top",function(){return n.offsetTop}),Object.preventExtensions(this)}ReminderSetter.REMINDER_TYPES={NO_DATE:1,TOMORROW:2,NEXT_WEEK:3,CUSTOM_DATE:4},Object.preventExtensions(ReminderSetter);