var port=port||null;var coToolbar=(function(){var x={},s={},r={},w={},m={},l="success",p="fail",n=true,y=null,e=null,d={toolbar:0,infobar:1},i=function(z,A){x[z]=A},v=function(z){return x[z]},j=function(z){var A={};if(x[z]&&x[z].html){A=decodeURI(x[z].html).trim();if(!A){x[z]=null}}return x[z]?true:false},t=function(z){x[z]=null},u=function(A,z){s[A]=z},f=function(z){return s[z]},b=function(z){return s[z]?true:false},q=function(z){s[z]=null},h=function(z,B,A){B.coToolbar=true;if(B.method_name){B.funcName=B.method_name}if(A){chrome.tabs.sendMessage(z,B,A)}else{chrome.tabs.sendMessage(z,B,function(){})}},g=function(z){m[z.method_name](z)},o=function(z){if(z.method_name){g(z)}},a=function(){if(!port){port=chrome.runtime.connectNative("com.nco.namsghst");n=true}if(port&&n){n=false;port.onMessage.addListener(function(z){if(z.messageName!=="chromeDOMMethodCall"||!z.tabId){return}window.setTimeout(o(z),0)});port.onDisconnect.addListener(function(){port=null;n=true})}return port},k=function(z){if(a()){a().postMessage(z)}},c=function(B,z,A){B.result=z;B.messageName="chromeHtmlMessage";B.messageType="callback";if(A){B.reason=A}k(B)};a();chrome.webNavigation.onCommitted.addListener(function(A){var z=A.tabId,B={},C={};if(!A.frameId){chrome.windows.getCurrent(function(D){if(chrome.runtime.lastError){return}B.funcName="OnCommitted";B.tabId=z;B.windowId=D.id;h(z,B);if(j(z)){C=v(z);if(C){C.fromBG=true;h(z,C)}}})}});chrome.webNavigation.onCompleted.addListener(function(A){var z=A.tabId,B={};if(!A.frameId){B.funcName="OnCompleted";B.tabId=z;h(z,B)}});chrome.browserAction.onClicked.addListener(function(B){var A=B.id,z=B.windowId,C={},D={};r[A]=false;C.funcName="OnBrowserAction";C.tabId=A;C.windowId=z;h(A,C);if(j(A)){D=v(A);if(D){D.fromBG=true;D.userAction=true;h(A,D)}}else{if(y){D.html=y;D.css=e;D.method_name="RenderHtml";D.funcName="RenderHtml";D.tabId=A;D.windowId=z;D.window_type=d.toolbar;D.fromBG=true;D.userAction=true;h(A,D)}}});chrome.tabs.onUpdated.addListener(function(A,z,B){var C={},D={};C.coToolbar=true;C.funcName="OnTabUpdated";C.tabId=A;C.windowId=B.windowId;C.url=B.url;h(A,C);if(j(A)){D=v(A);if(D){D.fromBG=true;h(A,D)}}});chrome.tabs.onActivated.addListener(function(z){var A={};A.coToolbar=true;A.funcName="OnActivated";A.tabId=z.tabId;h(z.tabId,A)});chrome.runtime.onMessage.addListener(function(E,F,A){if(E.coToolbar){if(!F.tab){return}var B=F.tab.id,H=F.tab.windowId,D={},C={},G={};a();switch(E.funcName){case"GetTabId":D.tabId=B;D.windowId=H;break;case"event":E.messageName="chromeHtmlMessage";E.messageType="callback";E.tabId=B;E.windowId=H;k(E);break;case"adjustFrameHeight":C.method_name="adjustFrameHeight";C.height=E.height;window.setTimeout(h(B,C),0);break;case"getScreenRect":E.messageName="chromeHtmlMessage";E.messageType="callback";E.method_name="GetElementLocation";k(E);break;case"updateToolbarChange":if(x[B]&&x[B].html){x[B].html=E.html}break;case"updateInfobarChange":if(s[B]&&s[B].html){s[B].html=E.html}break;case"updateSearchString":w[B]=E.search;break;case"updateLocation":window.setTimeout(h(B,E),0);break;case"getSearchString":if(w[B]){D.search=w[B]}break;case"fullScreenCheck":h(B,E);break;case"RenderHtmlAck":if(!E.toolbarVisible){C.funcName="ReloadIFrame";h(B,C)}break;case"toolbarFrameInjected":window.setTimeout(function(){C.funcName="OnFrameLoaded";C.tabId=B;C.windowId=H;h(B,C);if(j(B)){G=v(B);if(G){G.fromBG=true;h(B,G)}}else{if(y&&!r[B]){G.html=y;G.css=e;G.method_name="RenderHtml";G.funcName="RenderHtml";G.tabId=B;G.windowId=H;G.window_type=d.toolbar;G.fromBG=true;h(B,G)}}},0);break;case"closedToolbar":r[B]=true;y=null;e=null;break;case"EncryptPwd":var I=new Object();if(I){I.messageName=E.funcName;I.windowId=H;I.tabId=B;I.newvalue=E.pwd;var z={};z.cmd="encrypt";z.payload=I;NaclModulePostMessage(z)}break}if(A){A(D)}}});m.GetElementById=function(z){if(!z.id){c(z,p)}h(z.tabId,z,function(A){if(A){if(!A.result){c(z,p)}else{z.id=A.id;z.type=A.type;window.setTimeout(c(z,l),0)}}})};m.GetParentElement=function(z){if(!z.id){c(z,p)}h(z.tabId,z,function(A){if(A){if(!A.result){c(z,p)}else{z.id=A.id;z.type=A.type;window.setTimeout(c(z,l),0)}}})};m.GetElementText=function(z){if(!z.id){c(z,p)}h(z.tabId,z,function(A){if(A){if(!A.result){c(z,p)}else{z.id=A.id;z.type=A.type;z.text=A.text;z.encrypted=A.encrypted;window.setTimeout(c(z,l),0)}}})};m.GetElementHtml=function(z){if(!z.id){c(z,p)}h(z.tabId,z,function(A){if(A){if(!A.result){c(z,p)}else{z.id=A.id;z.type=A.type;z.html=A.html;window.setTimeout(c(z,l),0)}}})};m.GetAttributeByName=function(z){if(!z.id){c(z,p)}h(z.tabId,z,function(A){if(A){if(!A.result){c(z,p)}else{z.id=A.id;z.type=A.type;z.att_value=A.att_value;window.setTimeout(c(z,l),0)}}})};m.GetElementLocation=function(z){if(!z.id){c(z,p)}h(z.tabId,z)};m.RenderHtml=function(z){if(!z.html){c(z,p);return}if(d.toolbar===z.window_type){y=z.html;e=z.css;i(z.tabId,z)}else{if(d.infobar===z.window_type){u(z.tabId,z)}}h(z.tabId,z);c(z,l)};m.ShowToolbar=function(z){if(!z.html){c(z,p)}h(z.tabId,v(z.tabId));c(z,l)};m.ShowInfobar=function(z){if(!z.html){c(z,p)}h(z.tabId,f(z.tabId));c(z,l)};m.SetAttributeByName=function(z){if(!z.id){c(z,p)}h(z.tabId,z)};m.SetElementText=function(z){if(!z.id){c(z,p)}h(z.tabId,z)};m.ReplaceElementHtml=function(z){if(!z.id){c(z,p)}h(z.tabId,z)};m.CloseToolbar=function(z){if(!z.tabId){c(z,p)}t(z.tabId);h(z.tabId,z)};m.CloseInfobar=function(z){if(!z.tabId){c(z,p)}q(z.tabId);h(z.tabId,z)};m.IsToolbarVisible=function(z){if(!z.tabId){c(z,p)}h(z.tabId,z,function(A){z.visibility=A.visibility;window.setTimeout(c(z,l),0)})};m.IsInfobarVisible=function(z){if(!z.tabId){c(z,p)}h(z.tabId,z,function(A){z.visibility=A.visibility;window.setTimeout(c(z,l),0)})}}());