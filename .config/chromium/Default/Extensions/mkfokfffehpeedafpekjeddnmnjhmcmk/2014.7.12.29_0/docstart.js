var DOMCONTENTLOADED_EVENT="OnDOMContentLoaded";var BEGIN_NAV_EVENT="OnBeginNav";var END_NAV_EVENT="OnEndNav";var TAB_UPDATED="OnTabUpdated";var ALL_NAV_EVENTS="AllNavEvents";var _receivedBeginNav=false;var _firedBeginNav=false;var _receivedDOMContentLoaded=false;var _firedDOMContentLoaded=false;var _receivedEndNav=false;var _firedEndNav=false;var _receivedTabReplaced=false;var _firedFakeDOMContentLoaded=false;var _maxCheckCounter=0;var _injectedToolbarScript=false;var _tabId=0;var _windowId=0;var _incognitoMode=0;var _windowType=0;var _fid=0;var _urlPortalPageRegEx="http(s)?://identitysafe.norton.com/[a-zA-Z-]*/?client";var _isTopLevel=(top==self);var queueOfSubmittedForms=[];var timerClickEventQueue=0;var regexp=new RegExp(".(pdf)$","i");var _delayEvents=regexp.test(document.URL);if(false==_delayEvents){regexp=new RegExp("^(http|https)://www.divx.com/[a-z]|[a-z]-[a-z]/software/download/installed|(/chromium)","i");_delayEvents=regexp.test(document.URL)}function isInside(a,f,e,d,c,b){x1=Math.min(e,c);x2=Math.max(e,c);y1=Math.min(d,b);y2=Math.max(d,b);if((x1<=a)&&(a<=x2)&&(y1<=f)&&(f<=y2)){return true}else{return false}}var updatePortalPage=function(){var a=new RegExp(_urlPortalPageRegEx,"i");var b=a.test(document.URL);if(b){var c=document.createElement("div");c.setAttribute("style","display: none;");c.id="extension-is-installed-"+chrome.runtime.id;if(document.body){document.body.appendChild(c)}}};function SendMessageToNativeHost(a){chrome.runtime.sendMessage(a)}function getFrameId(){if(_fid===0){_fid=Math.floor((Math.random()*2147483646)+1)}return _fid}function CheckForEventInQueue(c){var b=0,a=queueOfSubmittedForms.length;for(b=0;b<a;b+=1){if(queueOfSubmittedForms[b]===c){return true}}if(!a&&!timerClickEventQueue){timerClickEventQueue=window.setInterval(function(){queueOfSubmittedForms=[];window.clearInterval(timerClickEventQueue);timerClickEventQueue=0},1000)}queueOfSubmittedForms.push(c);return false}function OnSubmit(s){var B=s.target;var v={};if($(s.target).is("form")){v=B}else{v=B.form;if(!v){v=$(B).closest("form")[0]}}var q=false;if(v){var u=v.getBoundingClientRect();var a=$(v).find("input:visible");for(var d=0;d<a.length;d++){var h=a[d];if(h){var k=h.getBoundingClientRect();if(k){var g=(k.right-k.left)/2+k.left;var f=(k.bottom-k.top)/2+k.top;if(!(isInside(g,f,u.left,u.top,u.right,u.bottom))){q=true;break}}}}}if(!v||q){q=true;v=window.document.body}if(true==CheckForEventInQueue(v)){return}var z=[];z.push(0);var l=[];l.push(0);var p={};var o={};if(!q){var w=v.getBoundingClientRect();p.value=ElementType.Form;o.value=InputType.Unknown;var e=WAX.processInput(v,w,p,o,true);if(null!=e){l.push(e.length);l.push(e)}}var n=new Rect(Number.MAX_VALUE,Number.MAX_VALUE,0,0,0,0);WAX.collectInputs(v,n,l,z,true);var j=[];j.push(0);WAX.collectNonInputs(v,n,l,j,z,true);l[0]=(l.length-1)/2;var r=l.join("#!#");r=l[1]=r.length+"#!#"+r;j[0]=(j.length-1)/2;if(1==j.length){j.push("0")}sLabels=j.join("#!#");sLabels=j[1]=sLabels.length+"#!#"+sLabels;var m=r+sLabels;m=m.length.toString()+"#!#"+m;var A=v.getBoundingClientRect();if(A){var t=Math.floor(A.width);var c=Math.floor(A.height);var b=new Rect(Math.floor(A.left),Math.floor(A.top),Math.floor(A.right),Math.floor(A.bottom),t,c);A=b}SendMessageToNativeHost({method:"OnSubmit",windowId:_windowId,tabId:_tabId,documentURL:document.URL.toString(),documentTitle:document.domain,button:B.id,elementData:{attributes:{id:$(v).attr("id"),name:$(v).attr("name")},boundingClientRect:A,tagName:v.tagName},sourceData:m})}function AddSubmitHandler(){var a=document.forms;for(i=0;i<a.length;i++){a[i].addEventListener("submit",OnSubmit,false)}if(null!=document.body){document.body.addEventListener("submit",OnSubmit,false)}}function FireEvent(d,c){if((0==_tabId)||(0==_windowId)){return false}var e=false;var a=(window==window.top?true:false);var b=getFrameId();if(BEGIN_NAV_EVENT==d){_receivedBeginNav=true;if(false==_firedBeginNav){_firedBeginNav=true;SendMessageToNativeHost({method:"NavEvent",windowId:_windowId,tabId:_tabId,topLevelNav:a,beginNav:true,documentURL:document.URL.toString(),fid:b});e=true}}else{if(DOMCONTENTLOADED_EVENT==d){FireEvent(BEGIN_NAV_EVENT,"");_receivedDOMContentLoaded=true;if(false==_firedDOMContentLoaded){_firedDOMContentLoaded=true;AddSubmitHandler();SendMessageToNativeHost({method:"DOMContentLoaded",windowId:_windowId,tabId:_tabId,topLevel:a,fid:b,documentURL:document.URL.toString(),documentTitle:document.title,documentReferrer:document.referrer,documentReadyState:document.readyState});e=true}}else{if(END_NAV_EVENT==d){FireEvent(BEGIN_NAV_EVENT,"");FireEvent(DOMCONTENTLOADED_EVENT,"");_receivedEndNav=true;if(false==_firedEndNav){_firedEndNav=true;SendMessageToNativeHost({method:"NavEvent",windowId:_windowId,tabId:_tabId,topLevelNav:a,beginNav:false,documentURL:document.URL.toString(),fid:b});e=true}}else{if(TAB_UPDATED==d){if("complete"==c){FireEvent(ALL_NAV_EVENTS,"")}SendMessageToNativeHost({method:"TabUpdated",windowId:_windowId,tabId:_tabId,status:c,documentURL:document.URL.toString()})}else{if(ALL_NAV_EVENTS==d){if(true==_receivedBeginNav){FireEvent(BEGIN_NAV_EVENT,"")}if(true==_receivedDOMContentLoaded){FireEvent(DOMCONTENTLOADED_EVENT,"")}if(true==_receivedEndNav){FireEvent(END_NAV_EVENT,"")}e=true}}}}}return e}function UpdateEmbedObject(){if((0==_tabId)||(0==_windowId)){return false}SendMessageToNativeHost({method:"ChromeSetId",windowId:_windowId,tabId:_tabId,incognitoMode:_incognitoMode,windowType:_windowType,topLevel:_isTopLevel});return true}function OnKeyDown(a){if(a.keycode==13){OnSubmit(a)}}function MessageFilter(a){switch(a){case"parseprefs":case"PerformAnalysis":case"AddAjaxEventListener":case"fillData":case"verifyandsubmit":case"verifyFilling":case"collectURLs":case"setResults":case"onCheckTabWindow":case"onTabReplaced":case"onSelectionChanged":case"onDOMContentLoaded":case"onCommitted":case"onCompleted":case"onUpdated":case"GetElementById":case"AddEventListener":return true;default:return false}}chrome.runtime.onMessage.addListener(function(f,d,r){if(typeof f.type=="undefined"){return}var m=f.windowId;var t=f.tabId;if((0==t)||(0==m)){return}var g=f.type;var j=window==window.top;if(MessageFilter(g)===false){return}if((t&&m)&&((t!=_tabId)||(m!=_windowId))){_windowId=m;_tabId=t;_incognitoMode=f.incognitoMode;_windowType=f.windowType;var s=getFrameId()}if("parseprefs"==g){var c=f.frameId;var s=getFrameId();if(parseInt(c,10)==s){if(undefined!=f.WCIDArguments){if((undefined!=f.WCIDArguments.responseType)&&("wcidDomLoadedResponse"==f.WCIDArguments.responseType)){var b=f.WCIDArguments.result;if(b!=undefined){wcidInit(b)}}}if(undefined!=f.WAXArguments){if((undefined!=f.WAXArguments.responseType)&&("waxDomLoadedResponse"==f.WAXArguments.responseType)){var q=f.WAXArguments.prefs;if(typeof q!=undefined){waxInit(q)}}}}}else{if("PerformAnalysis"==g){var c=f.frameId;var s=getFrameId();if(parseInt(c,10)==s){waxReparse()}}else{if("AddAjaxEventListener"==g){var c=f.frameId;var s=getFrameId();if(parseInt(c,10)==s){waxAddAjaxEventListener()}}else{if("fillData"==g){var c=f.frameId;var s=getFrameId();if(parseInt(c,10)==s){waxFill(f.msg)}}else{if(("verifyandsubmit"==g)||("verifyFilling"==g)){var c=f.frameId;var s=getFrameId();if(parseInt(c,10)!=s){return}if("verifyandsubmit"==g){setTimeout(function(){waxVerifyandSubmit(f.msg)},100)}if("verifyFilling"==g){waxVerify(f.msg)}}else{if("collectURLs"===g){if(_isTopLevel&&document.URL.search("nortonsafe.search.ask.com")>=0){return}var k=new Array();k=Shasta.collectURLs(f.frameid,f.siteid,f.rescan);var p=Shasta.getPageDirection();SendMessageToNativeHost({method:"collectURLsResponse",windowId:_windowId,tabId:_tabId,annotateURLsArray:k,dirStyle:p,caller_thread_id:f.caller_thread_id})}else{if("setResults"===g){var h=Shasta.setResults(f.scriptData);SendMessageToNativeHost({method:"setResultsResponse",windowId:_windowId,tabId:_tabId,returnValue:h,caller_thread_id:f.caller_thread_id})}else{if("onCheckTabWindow"==g){_maxCheckCounter=0;setTimeout(function(){SendMessageToNativeHost({method:"ChromeSetId",windowId:_windowId,tabId:_tabId,incognitoMode:_incognitoMode,windowType:_windowType,topLevel:_isTopLevel})},100)}else{if("onTabReplaced"==g){_receivedTabReplaced=true}else{if("onSelectionChanged"==g){_maxCheckCounter=0;setTimeout(function(){SendMessageToNativeHost({method:"ChromeSetId",windowId:_windowId,tabId:_tabId,incognitoMode:_incognitoMode,windowType:_windowType,topLevel:_isTopLevel})},100);if(true==_receivedTabReplaced){_receivedTabReplaced=false;setTimeout(function(){if((false==_receivedBeginNav)&&(false==_receivedDOMContentLoaded)){_firedFakeDOMContentLoaded=true;FireEvent(DOMCONTENTLOADED_EVENT,"")}},1000);setTimeout(function(){if(true==_firedFakeDOMContentLoaded){FireEvent(END_NAV_EVENT,"")}},500)}}else{if("onDOMContentLoaded"==g){_maxCheckCounter=0;FireEvent(DOMCONTENTLOADED_EVENT,"")}else{if("onCommitted"==g){_maxCheckCounter=0;FireEvent(BEGIN_NAV_EVENT,"")}else{if("onCompleted"==g){_maxCheckCounter=0;FireEvent(END_NAV_EVENT,"")}else{if(("onUpdated"==g)&&(typeof f.status!="undefined")&&(true==j)){if("complete"==f.status){_maxCheckCounter=0}FireEvent(TAB_UPDATED,f.status)}else{if("GetElementById"===g){var o=document.getElementById(f.id);var a={};if(o){a.id=o.id;a.type=o.tagName;a.result=true}else{a=false}SendMessageToNativeHost({method:"getElementByIdResponse",windowId:_windowId,tabId:_tabId,returnValue:a,caller_thread_id:f.caller_thread_id})}else{if("AddEventListener"===g){var e=document.getElementById(f.elementId);if(e==null){e=document.getElementsByName(f.elementName)[0];if(e==null){var n=f.XPosition;var l=f.YPosition;e=document.elementFromPoint(n,l)}}if(e==null){return}if(f.eventType==0){e.addEventListener("keydown",OnKeyDown,false)}else{e.addEventListener("click",OnSubmit,false)}}}}}}}}}}}}}}}}}});function ProcessNavStart(){if(0==_tabId){chrome.runtime.sendMessage({contentscript:"GetTabInfo"},function(a){_windowId=a.windowId;_tabId=a.tabId;_incognitoMode=a.incognitoMode;_windowType=a.windowType;SendMessageToNativeHost({method:"ChromeSetId",windowId:_windowId,tabId:_tabId,incognitoMode:_incognitoMode,windowType:_windowType,topLevel:_isTopLevel});ProcessNavStart()})}else{FireEvent(ALL_NAV_EVENTS,"")}}document.addEventListener("DOMContentLoaded",function(){FireEvent(DOMCONTENTLOADED_EVENT,"");updatePortalPage()});