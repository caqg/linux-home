var _gCommitCount={};var port=port||null;var conaclObject=null;var timeoutCollectUrls=0;var queueCollectUrls=[];var isNewlyConnected=true;var _extIdIdentitySafe="iikflkcanblccfahdhdonehdalibjnif";var _mapFeatures=[];var eSafeSearch=0;var eWebProtection=1;var eSafeShare=2;var eIdentitySafe=3;_mapFeatures[eSafeSearch]=true;_mapFeatures[eWebProtection]=true;_mapFeatures[eSafeShare]=true;_mapFeatures[eIdentitySafe]=false;function handleMessage(a){var c=a.data;if(c.result!="success"){return}var d=c.payload;if(d.callerId=="fillData"){chrome.tabs.sendMessage(d.tabId,{type:"fillData",tabId:d.tabId,windowId:d.windowId,frameId:d.frameid,msg:d})}else{if(d.messageName==="EncryptPwd"){var b={};b.coToolbar=true;b.funcName="OnEncryptPassword";b.tabId=d.tabId;b.encryptedData=d.newvalue;chrome.tabs.sendMessage(d.tabId,b,function(){})}else{if(d.callerId.indexOf("onSubmit")!=-1){d.sourceData=d.newvalue;postNativeMessage(d)}}}}function CreateEmbeddedObject(){var b=document.getElementById("conacl_codec");if(null==b){var a=document.createElement("embed");a.setAttribute("name","conacl_codec");a.setAttribute("id","conacl_codec");a.setAttribute("style","width: 100%; height: 0px; display: block;");a.setAttribute("src","coNaCl.nmf");a.setAttribute("type","application/x-nacl");a.addEventListener("message",handleMessage,true);b=document.documentElement.appendChild(a)}return b}function NaclModulePostMessage(a){if(null==conaclObject){conaclObject=CreateEmbeddedObject()}if((undefined!=conaclObject)&&(null!=conaclObject)){conaclObject.postMessage(a)}}function OnformfillVerify(a,b,d,f,e){var c=new Object();c.messageName="FormFillResult";c.windowId=a;c.tabId=b;c.documentURL=d;c.verifiedData=f;c.frameid=e;postNativeMessage(c)}function OnWindowClosed(a){var b=new Object();b.messageName="windowClosed";b.windowId=a;postNativeMessage(b)}function OnTabRemoved(a,b){var c=new Object();c.messageName="tabRemoved";c.windowId=a;c.tabId=b;postNativeMessage(c)}function OnTabAttached(c,a){var b=new Object();b.messageName="tabAttached";b.windowId=c;b.tabId=a;postNativeMessage(b)}function OnTabSelectionChanged(a,b){var c=new Object();c.messageName="tabSelectionChanged";c.windowId=a;c.tabId=b;postNativeMessage(c)}function SetActiveTab(a,b){var c=new Object();c.messageName="setActiveTab";c.windowId=a;c.tabId=b;postNativeMessage(c)}function OnChromeSetId(b,c,e,d,a){var f=new Object();f.messageName="chromeSetId";f.windowId=b;f.tabId=c;f.incognito=e;f.windowType=d;f.topLevel=a;postNativeMessage(f)}function OnDomEvent(a,b,d,f,c,g){var e=new Object();e.messageName="FormEvent";e.windowId=a;e.tabId=b;e.formEventType=d;e.documentURL=f;e.elementData=c;e.frameid=g;postNativeMessage(e)}function OnDomContentLoaded(h,b,a,d,c,f,g,e){var i=new Object();i.messageName="domContentLoaded";i.windowId=h;i.tabId=b;i.topLevel=a;i.frameid=d;i.documentURL=c;if((undefined!=f)||(""!=f)){i.documentTitle=f}if((undefined!=e)||(""!=e)){i.documentReadyState=e}if((undefined!=g)||(""!=g)){i.documentReferrer=g}postNativeMessage(i)}function OnTabUpdated(b,d,a,c){var e=new Object();e.messageName="chromeOnTabUpdated";e.windowId=b;e.tabId=d;e.status=a;e.documentURL=c;postNativeMessage(e)}function OnNavEvent(b,d,e,a,c,g){var f=new Object();f.messageName="chromeOnNavEvent";f.windowId=b;f.tabId=d;f.topLevel=e;f.beginNav=a;f.documentURL=c;f.frameid=g;postNativeMessage(f)}function OnBrowserAction(a,b,c){var d=new Object();d.messageName="showSafeWebPopupBrowser";d.windowId=a;d.tabId=b;postNativeMessage(d)}function OnContentData(a,c,d,g,e,b,h){var f=new Object();f.messageName="chromeCallback";f.windowId=a;f.tabId=c;f.origin=d;f.contentData=g;f.documentURL=e;f.collectionData=b;f.frameid=h;if(undefined==a){chrome.windows.getCurrent(function(i){if(chrome.runtime.lastError){return}f.windowId=i.id;postNativeMessage(f)})}else{postNativeMessage(f)}}function OnCollectURLsResponse(a,b,h,d,g){if(timeoutCollectUrls){window.clearTimeout(timeoutCollectUrls);timeoutCollectUrls=0}var e=new Object();e.messageName="collectURLsResponse";e.windowId=a;e.tabId=b;e.annotateURLsArray=h;e.dirStyle=d;e.caller_thread_id=g;var f=false;for(var c=0;c<queueCollectUrls.length;c+=1){if(queueCollectUrls[c].tabId===b&&queueCollectUrls[c].annotateURLsArray.length<h.length){queueCollectUrls[c]=e;f=true}}if(!f){queueCollectUrls.push(e)}timeoutCollectUrls=window.setTimeout(function(){while(queueCollectUrls.length){msg=queueCollectUrls.shift();postNativeMessage(msg)}timeoutCollectUrls=0},200)}function OnSetResultsResponse(a,b,d,e){var c=new Object();c.messageName="setResultsResponse";c.windowId=a;c.tabId=b;c.returnValue=d;c.caller_thread_id=e;postNativeMessage(c)}function OnGetElementByIdResponse(a,b,c,e){var d=new Object();d.messageName="getElementbyIdResponse";d.windowId=a;d.tabId=b;d.returnValue=c;d.caller_thread_id=e;postNativeMessage(d)}function OnCoShasta(a,b,d,e,f){var c=new Object();c.messageName="coShasta";c.windowId=a;c.tabId=b;c.frameid=d;c.collectionData=e;c.offset=f;postNativeMessage(c)}function OnCoShastaMouseUp(a,b,e,c,f){var d=new Object();d.messageName="coShastaMouseUp";d.windowId=a;d.tabId=b;d.frameid=e;d.button=c;d.collectionData=f;postNativeMessage(d)}function OnFormSubmit(h,c,i,d,g,e,f){var j=new Object();j.messageName="OnSubmit";j.windowId=h;j.tabId=c;j.button=g;j.elementData=e;j.documentURL=i;j.newvalue=f;j.documentTitle=d;var b={};b.cmd="encrypt";b.payload=j;var a="onSubmit"+c;j.callerId=a;NaclModulePostMessage(b)}function OnCoShastaScroll(a,b){var c=new Object();c.messageName="coShastaScroll";c.windowId=a;c.tabId=b;postNativeMessage(c)}function getImagePath(a){if(a=="coTB_Status_Green"){return"images/StatusButton/coBA_Safe.png"}else{if(a=="coTB_Status_Red"){return"images/StatusButton/coBA_dangerous.png"}else{if(a=="coTB_Status_Gray"){return"images/StatusButton/coBA_unknown.png"}else{if(a=="coTB_Status_NSecured"){return"images/StatusButton/coBA_Safe.png"}else{if(a=="coTB_Status_NAuth"){return"images/StatusButton/coBA_Safe.png"}else{if(a=="coTB_Status_Warn"){return"images/StatusButton/coBA_suspicious.png"}else{if(a=="coTB_Status_ShopGreen"){return"images/StatusButton/coBA_Safe.png"}else{if(a=="coTB_Status_ShopBad"){return"images/StatusButton/coBA_suspicious.png"}else{if(a=="coTB_Status_PageBadShopBad"){return"images/StatusButton/coBA_dangerous.png"}}}}}}}}}return"coBA_unknown.png"}function setRatings(f,b){for(var c=0;c<b.length;c++){var d=b[c].ratingsAction;var e=b[c].ratingsValue;if(d=="default_icon"){var a=getImagePath(e);chrome.browserAction.setIcon({path:a,tabId:f})}else{if(d=="default_title"){chrome.browserAction.setTitle({tabId:f,title:e})}}}}function NavigateTo(c,a,f,b){var g=true;try{if(0==f){chrome.tabs.update(c,{url:a})}if(1==f){chrome.windows.create({url:a,incognito:1==b?true:false})}else{if(2==f){chrome.tabs.create({url:a})}else{g=false}}}catch(d){g=false}return g}function RemoveFromHistory(a){var c=true;try{chrome.history.deleteUrl({url:a})}catch(b){c=false}return c}function GetURL(b){var a="";try{chrome.tabs.get(b,function(d){a=d.url})}catch(c){a=""}return a}function SetDefaultIcon(a){setRatings(a,["default_icon","coTB_Status_Gray","default_title","Norton"])}function getLayout(){return chrome.i18n.getMessage("@@bidi_dir")}function SendMesssage(f,d,b,a,e,g,h,c){if(-1==d){return}chrome.tabs.query({active:true,windowId:b},function(i){if(1==i.length){SetActiveTab(b,i[0].id)}});if(f=="parseprefs"){chrome.tabs.sendMessage(d,{type:f,tabId:d,windowId:b,frameId:g,WCIDArguments:h,WAXArguments:c},function(i){})}chrome.tabs.sendMessage(d,{type:f,tabId:d,windowId:b,incognitoMode:a,windowType:e},function(j){if(typeof j=="undefined"){var i=false;if("onSelectionChanged"==f){i=true;SetDefaultIcon(d)}else{if("onCompleted"==f){var k=_gCommitCount[d];if(typeof k=="undefined"){i=true;SetDefaultIcon(d);k=0}k++;_gCommitCount[d]=k}}if(true==i){OnChromeSetId(b,d,a,e,false)}}})}function onRequest(c,b,a){if((c.uninstall)&&(c.uninstall=="yes")){chrome.management.uninstallSelf()}if((c.contentscript)&&(c.contentscript=="GetTabInfo")){chrome.windows.get(b.tab.windowId,function(d){a({tabId:b.tab.id,windowId:b.tab.windowId,incognitoMode:b.tab.incognito,windowType:d.type})})}if((c.method)&&(c.method=="ChromeSetId")){OnChromeSetId(c.windowId,c.tabId,c.incognitoMode,c.windowType,c.topLevel)}if((c.method)&&(c.method=="ContentData")){if(c.contentOrigin){OnContentData(c.windowId,c.tabId,c.contentOrigin,c.sourceData,c.documentURL,c.collectionData,c.fid)}}if((c.method)&&(c.method=="DOMContentLoaded")){OnDomContentLoaded(c.windowId,c.tabId,c.topLevel,c.fid,c.documentURL)}if((c.method)&&(c.method=="TabUpdated")){OnTabUpdated(c.windowId,c.tabId,c.status,c.documentURL)}if((c.method)&&(c.method=="NavEvent")){OnNavEvent(c.windowId,c.tabId,c.topLevelNav,c.beginNav,c.documentURL,c.fid)}else{if((c.method)&&(c.method==="collectURLsResponse")){OnCollectURLsResponse(c.windowId,c.tabId,c.annotateURLsArray,c.dirStyle,c.caller_thread_id)}else{if((c.method)&&(c.method==="setResultsResponse")){OnSetResultsResponse(c.windowId,c.tabId,c.returnValue,c.caller_thread_id)}else{if((c.method)&&(c.method==="coShasta")){OnCoShasta(c.windowId,c.tabId,c.frameId,c.collectionData,c.offset)}else{if((c.method)&&(c.method==="coShastaScroll")){OnCoShastaScroll(c.windowId,c.tabId)}else{if((c.method)&&(c.method==="coShastaMouseUp")){OnCoShastaMouseUp(c.windowId,c.tabId,c.frameId,c.button,c.collectionData)}else{if((c.method)&&(c.method==="verifyFilling")){OnformfillVerify(c.windowId,c.tabId,c.documentURL,c.verifyData,c.fid)}else{if((c.method)&&(c.method==="OnSubmit")){OnFormSubmit(c.windowId,c.tabId,c.documentURL,c.documentTitle,c.button,c.elementData,c.sourceData)}else{if((c.method)&&(c.method==="OnDomEvent")){OnDomEvent(c.windowId,c.tabId,c.eventType,c.documentURL,c.elementData,c.fid)}else{if((c.method)&&(c.method==="getElementByIdResponse")){OnGetElementByIdResponse(c.windowId,c.tabId,c.returnValue,c.caller_thread_id)}}}}}}}}}}return true}function checkAndUpdateExtnStatus(a){chrome.management.get(a,function(b){if(b&&b.enabled){_mapFeatures[eIdentitySafe]=true;SetSupportedFeatures()}else{_mapFeatures[eIdentitySafe]=false;SetSupportedFeatures()}})}function AddEventListeners(){checkAndUpdateExtnStatus(_extIdIdentitySafe);chrome.runtime.onMessage.addListener(onRequest);var b=chrome.runtime.getManifest();if(!b){return}var a=b.version;if(!a){return}chrome.webNavigation.onCommitted.addListener(function(d){var c=d.tabId;chrome.windows.getCurrent(function(e){if(chrome.runtime.lastError){return}SendMesssage("onCommitted",c,e.id,e.incognito,e.type)})});chrome.webNavigation.onDOMContentLoaded.addListener(function(d){var c=d.tabId;chrome.windows.getCurrent(function(e){if(chrome.runtime.lastError){return}SendMesssage("onDOMContentLoaded",c,e.id,e.incognito,e.type)})});chrome.webNavigation.onCompleted.addListener(function(d){var c=d.tabId;chrome.windows.getCurrent(function(e){if(chrome.runtime.lastError){return}SendMesssage("onCompleted",c,e.id,e.incognito,e.type)})});chrome.windows.onRemoved.addListener(function(c){OnWindowClosed(c)});chrome.tabs.onRemoved.addListener(function(d,c){OnTabRemoved(c.windowId,d)});chrome.tabs.onCreated.addListener(function(c){checkAndUpdateExtnStatus(_extIdIdentitySafe)});chrome.tabs.onAttached.addListener(function(c,d){OnTabAttached(d.newWindowId,c)});chrome.tabs.onSelectionChanged.addListener(function(d,e){var c=e.windowId;OnTabSelectionChanged(e.windowId,d);chrome.windows.getCurrent(function(f){if(chrome.runtime.lastError){return}OnChromeSetId(f.id,d,f.incognito,f.type,false);SendMesssage("onSelectionChanged",d,f.id,f.incognito,f.type)})});chrome.browserAction.onClicked.addListener(function(c){OnBrowserAction(c.windowId,c.id,c.url)});chrome.tabs.onUpdated.addListener(function(d,c,e){chrome.windows.getCurrent(function(f){if(chrome.runtime.lastError){return}chrome.tabs.sendMessage(d,{type:"onUpdated",status:c.status,tabId:d,windowId:e.windowId,incognitoMode:f.incognito,windowType:f.type})})});chrome.tabs.onActivated.addListener(function(c){var d=c.tabId;SetActiveTab(c.windowId,d);chrome.windows.getCurrent(function(e){if(chrome.runtime.lastError){return}SendMesssage("onCheckTabWindow",d,e.id,e.incognito,e.type)})});SetSupportedFeatures()}conaclObject=CreateEmbeddedObject();function NativeMessageHostHandler(c){if(c!=undefined){var b=c.callerId;if(b=="parseprefs"){SendMesssage("parseprefs",c.tabId,c.windowId,undefined,undefined,c.frameid,c.WCIDArguments,c.WAXArguments)}else{if(b==="NavigateTo"){NavigateTo(c.tabId,c.documentURL,c.NavigateToUrlOpenFlag,c.incognitoMode)}else{if(b==="SetInnerHtml"){chrome.tabs.sendMessage(c.tabId,{type:"setElementInnerHtml",tabId:c.tabId,windowId:c.windowId,id:c.id,innerHtml:c.innerHtml})}else{if(b==="SetElementText"){chrome.tabs.sendMessage(c.tabId,{type:"setElementText",tabId:c.tabId,windowId:c.windowId,id:c.id,text:c.text})}else{if(b==="SetAttributeByName"){chrome.tabs.sendMessage(c.tabId,{type:"setAttributeByName",tabId:c.tabId,windowId:c.windowId,id:c.id,attributeName:c.att_name,attributeValue:c.att_value})}else{if(b==="setRatings"){setRatings(c.tabId,c.ratingsArray)}else{if(b=="fillData"){var a=new Object();a.cmd="decrypt";a.payload=c;NaclModulePostMessage(a)}else{if(b==="collectURLs"){chrome.tabs.sendMessage(c.tabId,{type:"collectURLs",tabId:c.tabId,windowId:c.windowId,caller_thread_id:c.caller_thread_id,frameid:c.frameid,siteid:c.siteid,rescan:c.rescan})}else{if(b==="setResults"){chrome.tabs.sendMessage(c.tabId,{type:"setResults",tabId:c.tabId,windowId:c.windowId,scriptData:c.annotateURLRatingsArray,caller_thread_id:c.caller_thread_id})}else{if(b=="verifyandsubmit"){chrome.tabs.sendMessage(c.tabId,{type:"verifyandsubmit",tabId:c.tabId,windowId:c.windowId,frameId:c.frameid,msg:c})}else{if(b=="verifyFilling"){chrome.tabs.sendMessage(c.tabId,{type:"verifyFilling",tabId:c.tabId,windowId:c.windowId,frameId:c.frameid,msg:c})}else{if(b=="servicePluginReconnect"){ServicePluginReconnect();SetSupportedFeatures()}else{if(b=="GetElementById"){chrome.tabs.sendMessage(c.tabId,{type:"GetElementById",tabId:c.tabId,windowId:c.windowId,id:c.id,caller_thread_id:c.caller_thread_id})}else{if(b=="PerformAnalysis"){setTimeout(function(){chrome.tabs.sendMessage(c.tabId,{type:"PerformAnalysis",tabId:c.tabId,windowId:c.windowId,frameId:c.frameid,msg:c})},750)}else{if(b=="AddAjaxEventListener"){chrome.tabs.sendMessage(c.tabId,{type:"AddAjaxEventListener",tabId:c.tabId,windowId:c.windowId,frameId:c.frameid,msg:c})}else{if(b=="AddEventListener"){chrome.tabs.sendMessage(c.tabId,{type:"AddEventListener",tabId:c.tabId,windowId:c.frameId,elementId:c.id,elementName:c.name,XPosition:c.XPosition,YPosition:c.YPosition,eventType:c.EventType})}}}}}}}}}}}}}}}}}}function getNativePort(){if(!port){port=chrome.runtime.connectNative("com.nco.namsghst");isNewlyConnected=true}if(port&&isNewlyConnected){isNewlyConnected=false;port.onMessage.addListener(function(a){NativeMessageHostHandler(a)});port.onDisconnect.addListener(function(){port=null;isNewlyConnected=true});checkAndUpdateExtnStatus(_extIdIdentitySafe)}return port}getNativePort();function postNativeMessage(a){var b=getNativePort();if(b){b.postMessage(a)}}var manifestEntry=chrome.runtime.getManifest();if(undefined!=manifestEntry){var fullversion=manifestEntry.version;var n=fullversion.lastIndexOf(".");var version=fullversion;if(n!=-1){version=fullversion.slice(0,n)}version=version.replace(/\./g,"");if((undefined!=manifestEntry.name)&&(undefined!=version)){var versionMessage="versiondetails:"+manifestEntry.name+":"+version+":";postNativeMessage(versionMessage)}}AddEventListeners();setTimeout(function(){chrome.tabs.getSelected(null,function(a){if(chrome.runtime.lastError){return}var b=a.id;if(typeof _gCommitCount[b]=="undefined"){chrome.windows.getCurrent(function(d){if(chrome.runtime.lastError){return}var c=d.id;OnChromeSetId(c,b,d.incognito,d.type,false)})}})},100);var _jsReExecuteDocStart={code:"ProcessNavStart(); _receivedBeginNav = true; _receivedDOMContentLoaded = true; _receivedEndNav = true; _firedBeginNav = false; _firedDOMContentLoaded = false; _firedEndNav = false; FireEvent(END_NAV_EVENT, ''); "};var newtabURL="chrome://newtab/";function ServicePluginReconnect(){chrome.windows.getAll(function(b){for(var c=0;c<b.length;++c){var a=b[c].id;chrome.tabs.query({windowId:a},function(f){var g=[];for(var d=0;d<f.length;++d){try{var j=f[d];if(j.url===newtabURL){g.push(j.id);continue}chrome.tabs.executeScript(j.id,_jsReExecuteDocStart,function(e){if(chrome.runtime.lastError){return}})}catch(h){}}setTimeout(function(){while(g.length>0){var e=g.shift();chrome.tabs.reload(e)}},50)})}})}chrome.runtime.onMessageExternal.addListener(function(c,b,a){if(_extIdIdentitySafe===b.id){if(c.setExtensionFeature===eIdentitySafe){_mapFeatures[eIdentitySafe]=true;SetSupportedFeatures()}}return});chrome.management.onInstalled.addListener(function(a){if(_extIdIdentitySafe===a.id){_mapFeatures[eIdentitySafe]=true;SetSupportedFeatures()}});chrome.management.onUninstalled.addListener(function(a){if(_extIdIdentitySafe===a){_mapFeatures[eIdentitySafe]=false;SetSupportedFeatures()}});chrome.management.onEnabled.addListener(function(a){if(_extIdIdentitySafe===a.id){_mapFeatures[eIdentitySafe]=true;SetSupportedFeatures()}});chrome.management.onDisabled.addListener(function(a){if(_extIdIdentitySafe===a.id){_mapFeatures[eIdentitySafe]=false;SetSupportedFeatures()}});function SetSupportedFeatures(){chrome.windows.getCurrent(function(b){if(chrome.runtime.lastError){return}if(undefined!=b){var a=new Object();a.messageName="SetSupportedFeatures";a.windowId=b.id;a.FeaturesMap=_mapFeatures;a.FeaturesMapLength=_mapFeatures.length;postNativeMessage(a)}})};